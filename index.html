<!doctype html>
<html lang="th">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏£‡∏ñ Emergency</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
      font-family: 'Prompt', sans-serif;
    }
    * {
      font-family: 'Prompt', sans-serif;
    }
    .modal-backdrop {
      backdrop-filter: blur(4px);
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <style>
  /* ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠: ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡πÅ‡∏ñ‡∏ß‡πÉ‡∏´‡πâ‡πÄ‡∏•‡πá‡∏Å‡∏•‡∏á */
  @media (max-width: 640px) {
    /* ‡∏•‡∏î padding ‡∏Ç‡∏≠‡∏á‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏•‡∏á‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏´‡∏ô‡∏∂‡πà‡∏á */
    table thead th {
      padding-top: 0.4rem !important;  /* ‡πÄ‡∏î‡∏¥‡∏°‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì 0.8rem */
      padding-bottom: 0.4rem !important;
      font-size: 0.75rem !important;   /* ‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏ô‡∏¥‡∏î‡∏´‡∏ô‡πà‡∏≠‡∏¢ */
    }

    /* ‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏Ç‡∏≠‡∏á‡πÅ‡∏ñ‡∏ß‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (¬æ ‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏î‡∏¥‡∏°) */
    table tbody td {
      padding-top: 0.5rem !important;  /* ‡πÄ‡∏î‡∏¥‡∏° ~0.75rem */
      padding-bottom: 0.5rem !important;
      font-size: 0.8rem !important;    /* ‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡πÉ‡∏´‡πâ‡∏™‡∏°‡∏î‡∏∏‡∏• */
    }

    /* ‡∏•‡∏î margin/padding ‡∏Ç‡∏≠‡∏á container ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ */
    .p-6 {
      padding: 1rem !important;
    }

    /* ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏•‡∏∞‡∏´‡∏±‡∏ß‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÉ‡∏´‡πâ‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏à‡∏≠‡πÄ‡∏•‡πá‡∏Å */
    #add-medicine-btn {
      padding: 0.4rem 0.8rem !important;
      font-size: 0.8rem !important;
    }
    h2.text-xl {
      font-size: 1rem !important;
    }
  }
</style>
  <style>
  @media (max-width: 640px) {
    #submit-inspection {
      width: 100%;
      max-width: 320px;
      justify-content: center;
      font-size: 1rem;
    }
  }
</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="bg-gradient-to-br from-emerald-50 to-teal-50 min-h-full">
  <div class="max-w-7xl mx-auto p-4 sm:p-6"><!-- Header -->
   <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
    <div class="flex items-center justify-between mb-4">
     <div class="flex items-center gap-3">
  <div class="bg-emerald-500 p-3 rounded-xl">
    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
    </svg>
  </div>

  <!-- ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏≠‡∏õ + ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô + ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ -->
  <div class="flex flex-col">
    <h1 id="app-title" class="text-lg xs:text-xl sm:text-2xl md:text-3xl font-bold text-gray-800 leading-tight">
      ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏¢‡∏≤‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏ä‡∏†‡∏±‡∏ì‡∏ë‡πå‡∏£‡∏ñ Emergency 7/4
    </h1>

    <span class="text-xs sm:text-sm text-gray-500 mt-1">
      ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• ‡∏™‡∏ñ‡∏≤‡∏ö‡∏±‡∏ô‡∏ö‡∏≥‡∏£‡∏≤‡∏®‡∏ô‡∏£‡∏≤‡∏î‡∏π‡∏£
    </span>

    <div class="flex items-center gap-2 mt-1">
      <div id="status-indicator" class="w-2 h-2 rounded-full bg-gray-400 animate-pulse"></div>
      <span id="status-text" class="text-sm text-gray-600">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...</span>
    </div>
  </div>
</div>
   </div><!-- Medicine Table -->
   <div class="bg-white rounded-2xl shadow-lg overflow-hidden mb-6">
    <div class="p-6 border-b border-gray-200">
     <div class="flex flex-col sm:flex-col gap-3">
  <h2 class="text-xl sm:text-2xl font-bold text-gray-800 flex items-center gap-2">
    <span class="text-2xl">üìã</span>
    ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡∏≤‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏ä‡∏†‡∏±‡∏ì‡∏ë‡πå
  </h2>

  <div>
    <button
      id="add-medicine-btn"
      class="bg-emerald-500 hover:bg-emerald-600 text-white font-semibold py-2 px-4 rounded-xl transition-all duration-200 flex items-center gap-2 shadow-md"
    >
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
      </svg>
      <span id="add-button-text">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏¢‡∏≤/‡πÄ‡∏ß‡∏ä‡∏†‡∏±‡∏ì‡∏ë‡πå‡πÉ‡∏´‡∏°‡πà</span>
    </button>
  </div>
</div>
    <div class="p-6">
     <div class="overflow-x-auto">
      <table class="w-full bg-white rounded-2xl overflow-hidden shadow-sm border border-gray-100">
       <thead class="bg-gradient-to-r from-emerald-500 to-emerald-600 text-white">
        <tr>
         <th class="px-6 py-3 text-left font-semibold rounded-tl-2xl">‡∏¢‡∏≤/‡πÄ‡∏ß‡∏ä‡∏†‡∏±‡∏ì‡∏ë‡πå</th>
         <th class="px-6 py-3 text-center font-semibold">‚è∞ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th>
         <th class="px-6 py-3 text-center font-semibold">üè∑Ô∏è ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
         <th class="px-6 py-3 text-center font-semibold rounded-tr-2xl">‚öôÔ∏è ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
        </tr>
       </thead>
       <tbody id="medicine-table-body" class="divide-y divide-gray-100"><!-- Items will be inserted here -->
       </tbody>
      </table>
     </div>
    </div>
    <div id="empty-state" class="text-center py-12 text-gray-400 hidden">
     <svg class="w-16 h-16 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"></path>
     </svg>
     <p class="text-lg font-medium">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
     <p class="text-sm">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ß‡∏ä‡∏†‡∏±‡∏ì‡∏ë‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</p>
    </div>
   </div><!-- Emergency Car Inspection Form -->
   <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
    <div class="p-6 border-b border-gray-200">
     <h2 class="text-xl font-bold text-gray-800 flex items-center gap-2"><span class="text-2xl">üöë</span> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏ñ Emergency</h2>
    </div>
    <form id="emergencyForm" class="bg-white rounded-lg shadow-lg p-4 md:p-6"><!-- Basic Info -->
     <div class="grid grid-cols-1 md:grid-cols-3 gap-3 md:gap-4 mb-4 md:mb-6">
      <div><label class="block text-emerald-700 font-medium mb-2 text-base md:text-lg">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà <span class="text-red-500">*</span></label> <input type="date" id="date" class="w-full p-3 md:p-4 border border-emerald-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 text-base md:text-lg" required>
      </div>
      <div><label class="block text-emerald-700 font-medium mb-2 text-base md:text-lg">‡πÄ‡∏ß‡∏£ <span class="text-red-500">*</span></label> <select id="shift" class="w-full p-3 md:p-4 border border-emerald-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 text-base md:text-lg" required> <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏£</option> <option value="‡πÄ‡∏ä‡πâ‡∏≤">‡πÄ‡∏ä‡πâ‡∏≤</option> <option value="‡∏ö‡πà‡∏≤‡∏¢">‡∏ö‡πà‡∏≤‡∏¢</option> <option value="‡∏î‡∏∂‡∏Å">‡∏î‡∏∂‡∏Å</option> </select>
      </div>
      <div><label class="block text-emerald-700 font-medium mb-2 text-base md:text-lg">ID</label> <input type="text" id="checkId" class="w-full p-3 md:p-4 border border-emerald-300 rounded-lg bg-gray-100 text-base md:text-lg" readonly>
      </div>
     </div><!-- Medicine Box Type -->
     <div id="medicineSection" class="mb-4 md:mb-6"><label class="block text-emerald-700 font-medium mb-3 md:mb-4 text-base md:text-lg">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó Box ‡∏¢‡∏≤ <span class="text-red-500">*</span></label>
      <div class="space-y-3 md:space-y-4"><label class="flex items-center space-x-3 md:space-x-4"> <input type="radio" name="medicineType" value="‡∏°‡∏µ Box ‡∏¢‡∏≤" class="w-5 h-5 md:w-6 md:h-6 text-emerald-600 focus:ring-emerald-500" required> <span class="text-emerald-700 text-base md:text-lg">‡∏°‡∏µ Box ‡∏¢‡∏≤</span> </label> <label class="flex items-center space-x-3 md:space-x-4"> <input type="radio" name="medicineType" value="Box ‡∏¢‡∏≤‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡πÅ‡∏ú‡∏ô‡∏Å‡∏≠‡∏∑‡πà‡∏ô" class="w-5 h-5 md:w-6 md:h-6 text-emerald-600 focus:ring-emerald-500" required> <span class="text-emerald-700 text-base md:text-lg">Box ‡∏¢‡∏≤‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡πÅ‡∏ú‡∏ô‡∏Å‡∏≠‡∏∑‡πà‡∏ô</span> </label>
      </div>
     </div><!-- Medicine Checklist -->
     <div id="medicineChecklist" class="mb-4 md:mb-6 hidden">
      <h3 class="text-lg md:text-xl font-semibold text-emerald-800 mb-3 md:mb-4">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡∏≤</h3>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 md:gap-4">
       <div class="p-4 bg-white rounded-lg border"><label class="block text-base md:text-lg font-medium text-gray-700 mb-3">Adenosine (6 mg./vial) 3 amp</label>
        <div class="flex justify-between"><label class="flex items-center space-x-2"> <input type="radio" name="adenosine" value="‚úì" class="w-4 h-4 md:w-5 md:h-5 text-emerald-600"> <span class="text-green-600 text-base md:text-lg">‚úì</span> </label> <label class="flex items-center space-x-2"> <input type="radio" name="adenosine" value="‚úó" class="w-4 h-4 md:w-5 md:h-5 text-red-600"> <span class="text-red-600 text-base md:text-lg">‚úó</span> </label>
        </div>
       </div>
       <div class="p-4 bg-white rounded-lg border"><label class="block text-base md:text-lg font-medium text-gray-700 mb-3">Adrenaline ( 1 : 1000 ) 30 amp</label>
        <div class="flex justify-between"><label class="flex items-center space-x-2"> <input type="radio" name="adrenaline" value="‚úì" class="w-4 h-4 md:w-5 md:h-5 text-emerald-600"> <span class="text-green-600 text-base md:text-lg">‚úì</span> </label> <label class="flex items-center space-x-2"> <input type="radio" name="adrenaline" value="‚úó" class="w-4 h-4 md:w-5 md:h-5 text-red-600"> <span class="text-red-600 text-base md:text-lg">‚úó</span> </label>
        </div>
       </div>
       <div class="p-4 bg-white rounded-lg border"><label class="block text-base md:text-lg font-medium text-gray-700 mb-3">Atropine (0.6 mg/amp.) 4 amp</label>
        <div class="flex justify-between"><label class="flex items-center space-x-2"> <input type="radio" name="atropine" value="‚úì" class="w-4 h-4 md:w-5 md:h-5 text-emerald-600"> <span class="text-green-600 text-base md:text-lg">‚úì</span> </label> <label class="flex items-center space-x-2"> <input type="radio" name="atropine" value="‚úó" class="w-4 h-4 md:w-5 md:h-5 text-red-600"> <span class="text-red-600 text-base md:text-lg">‚úó</span> </label>
        </div>
       </div>
       <div class="p-4 bg-white rounded-lg border"><label class="block text-base md:text-lg font-medium text-gray-700 mb-3">Amiodarone 3 amp</label>
        <div class="flex justify-between"><label class="flex items-center space-x-2"> <input type="radio" name="amiodarone" value="‚úì" class="w-4 h-4 md:w-5 md:h-5 text-emerald-600"> <span class="text-green-600 text-base md:text-lg">‚úì</span> </label> <label class="flex items-center space-x-2"> <input type="radio" name="amiodarone" value="‚úó" class="w-4 h-4 md:w-5 md:h-5 text-red-600"> <span class="text-red-600 text-base md:text-lg">‚úó</span> </label>
        </div>
       </div>
       <div class="p-4 bg-white rounded-lg border"><label class="block text-base md:text-lg font-medium text-gray-700 mb-3">Dopamine 250 mg/amp (2 amp)</label>
        <div class="flex justify-between"><label class="flex items-center space-x-2"> <input type="radio" name="dopamine" value="‚úì" class="w-4 h-4 md:w-5 md:h-5 text-emerald-600"> <span class="text-green-600 text-base md:text-lg">‚úì</span> </label> <label class="flex items-center space-x-2"> <input type="radio" name="dopamine" value="‚úó" class="w-4 h-4 md:w-5 md:h-5 text-red-600"> <span class="text-red-600 text-base md:text-lg">‚úó</span> </label>
        </div>
       </div>
       <div class="p-4 bg-white rounded-lg border"><label class="block text-base md:text-lg font-medium text-gray-700 mb-3">10% Calcium Gluconate (10 ml./amp.) 3 amp</label>
        <div class="flex justify-between"><label class="flex items-center space-x-2"> <input type="radio" name="calcium_gluconate" value="‚úì" class="w-4 h-4 md:w-5 md:h-5 text-emerald-600"> <span class="text-green-600 text-base md:text-lg">‚úì</span> </label> <label class="flex items-center space-x-2"> <input type="radio" name="calcium_gluconate" value="‚úó" class="w-4 h-4 md:w-5 md:h-5 text-red-600"> <span class="text-red-600 text-base md:text-lg">‚úó</span> </label>
        </div>
       </div>
       <div class="p-4 bg-white rounded-lg border"><label class="block text-base md:text-lg font-medium text-gray-700 mb-3">7.5% NaHCO3 (50 ml./amp.) 2 amp</label>
        <div class="flex justify-between"><label class="flex items-center space-x-2"> <input type="radio" name="nahco3" value="‚úì" class="w-4 h-4 md:w-5 md:h-5 text-emerald-600"> <span class="text-green-600 text-base md:text-lg">‚úì</span> </label> <label class="flex items-center space-x-2"> <input type="radio" name="nahco3" value="‚úó" class="w-4 h-4 md:w-5 md:h-5 text-red-600"> <span class="text-red-600 text-base md:text-lg">‚úó</span> </label>
        </div>
       </div>
       <div class="p-4 bg-white rounded-lg border"><label class="block text-base md:text-lg font-medium text-gray-700 mb-3">50% Glucose (50 ml./vial) 1 vial</label>
        <div class="flex justify-between"><label class="flex items-center space-x-2"> <input type="radio" name="glucose" value="‚úì" class="w-4 h-4 md:w-5 md:h-5 text-emerald-600"> <span class="text-green-600 text-base md:text-lg">‚úì</span> </label> <label class="flex items-center space-x-2"> <input type="radio" name="glucose" value="‚úó" class="w-4 h-4 md:w-5 md:h-5 text-red-600"> <span class="text-red-600 text-base md:text-lg">‚úó</span> </label>
        </div>
       </div>
       <div class="p-4 bg-white rounded-lg border"><label class="block text-base md:text-lg font-medium text-gray-700 mb-3">50% MgSO4 (2 ml./amp) 2 amp</label>
        <div class="flex justify-between"><label class="flex items-center space-x-2"> <input type="radio" name="mgso4" value="‚úì" class="w-4 h-4 md:w-5 md:h-5 text-emerald-600"> <span class="text-green-600 text-base md:text-lg">‚úì</span> </label> <label class="flex items-center space-x-2"> <input type="radio" name="mgso4" value="‚úó" class="w-4 h-4 md:w-5 md:h-5 text-red-600"> <span class="text-red-600 text-base md:text-lg">‚úó</span> </label>
        </div>
       </div>
       <div class="p-4 bg-white rounded-lg border"><label class="block text-base md:text-lg font-medium text-gray-700 mb-3">Valium (10 mg./amp.) 2 amp</label>
        <div class="flex justify-between"><label class="flex items-center space-x-2"> <input type="radio" name="valium" value="‚úì" class="w-4 h-4 md:w-5 md:h-5 text-emerald-600"> <span class="text-green-600 text-base md:text-lg">‚úì</span> </label> <label class="flex items-center space-x-2"> <input type="radio" name="valium" value="‚úó" class="w-4 h-4 md:w-5 md:h-5 text-red-600"> <span class="text-red-600 text-base md:text-lg">‚úó</span> </label>
        </div>
       </div>
      </div>
     </div><!-- Equipment Section -->
     <div class="space-y-6">
      <div class="bg-blue-50 p-4 rounded-xl">
       <h3 class="font-bold text-blue-800 mb-4 text-lg md:text-xl">‡∏ä‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà 1</h3><!-- Equipment Section -->
       <div class="space-y-4">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
         <div class="p-4 bg-white rounded-lg border"><label class="block text-base md:text-lg font-medium text-gray-700 mb-3">üíâ Syringe Disposable ‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏•‡∏∞ 3 <span class="text-red-500">*</span></label>
          <div class="flex justify-between"><label class="flex items-center space-x-2"> <input type="radio" name="syringe" value="‚úì" class="w-4 h-4 md:w-5 md:h-5 text-emerald-600" required> <span class="text-green-600 text-base md:text-lg">‚úì</span> </label> <label class="flex items-center space-x-2"> <input type="radio" name="syringe" value="‚úó" class="w-4 h-4 md:w-5 md:h-5 text-red-600" required> <span class="text-red-600 text-base md:text-lg">‚úó</span> </label>
          </div>
         </div>
         <div class="p-4 bg-white rounded-lg border"><label class="block text-base md:text-lg font-medium text-gray-700 mb-3">üìè Extension Tube 3 set <span class="text-red-500">*</span></label>
          <div class="flex justify-between"><label class="flex items-center space-x-2"> <input type="radio" name="extension_tube" value="‚úì" class="w-4 h-4 md:w-5 md:h-5 text-emerald-600" required> <span class="text-green-600 text-base md:text-lg">‚úì</span> </label> <label class="flex items-center space-x-2"> <input type="radio" name="extension_tube" value="‚úó" class="w-4 h-4 md:w-5 md:h-5 text-red-600" required> <span class="text-red-600 text-base md:text-lg">‚úó</span> </label>
          </div>
         </div>
         <div class="p-4 bg-white rounded-lg border"><label class="block text-base md:text-lg font-medium text-gray-700 mb-3">üîó Set IV 3 set <span class="text-red-500">*</span></label>
          <div class="flex justify-between"><label class="flex items-center space-x-2"> <input type="radio" name="iv_set" value="‚úì" class="w-4 h-4 md:w-5 md:h-5 text-emerald-600" required> <span class="text-green-600 text-base md:text-lg">‚úì</span> </label> <label class="flex items-center space-x-2"> <input type="radio" name="iv_set" value="‚úó" class="w-4 h-4 md:w-5 md:h-5 text-red-600" required> <span class="text-red-600 text-base md:text-lg">‚úó</span> </label>
          </div>
         </div>
         <div class="p-4 bg-white rounded-lg border"><label class="block text-base md:text-lg font-medium text-gray-700 mb-3">ü©∏ IV Catheter No. 24, 22, 20, 18 ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏•‡∏∞ 3 <span class="text-red-500">*</span></label>
          <div class="flex justify-between"><label class="flex items-center space-x-2"> <input type="radio" name="iv_catheter" value="‚úì" class="w-4 h-4 md:w-5 md:h-5 text-emerald-600" required> <span class="text-green-600 text-base md:text-lg">‚úì</span> </label> <label class="flex items-center space-x-2"> <input type="radio" name="iv_catheter" value="‚úó" class="w-4 h-4 md:w-5 md:h-5 text-red-600" required> <span class="text-red-600 text-base md:text-lg">‚úó</span> </label>
          </div>
         </div>
         <div class="p-4 bg-white rounded-lg border"><label class="block text-base md:text-lg font-medium text-gray-700 mb-3">ü™° ‡πÄ‡∏Ç‡πá‡∏°‡∏â‡∏µ‡∏î‡∏¢‡∏≤ ‡πÄ‡∏ö‡∏≠‡∏£‡πå18-24 ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏•‡∏∞ 10 <span class="text-red-500">*</span></label>
          <div class="flex justify-between"><label class="flex items-center space-x-2"> <input type="radio" name="needle" value="‚úì" class="w-4 h-4 md:w-5 md:h-5 text-emerald-600" required> <span class="text-green-600 text-base md:text-lg">‚úì</span> </label> <label class="flex items-center space-x-2"> <input type="radio" name="needle" value="‚úó" class="w-4 h-4 md:w-5 md:h-5 text-red-600" required> <span class="text-red-600 text-base md:text-lg">‚úó</span> </label>
          </div>
         </div>
         <div class="p-4 bg-white rounded-lg border"><label class="block text-base md:text-lg font-medium text-gray-700 mb-3">üîÄ Three - way 3 ‡∏≠‡∏±‡∏ô <span class="text-red-500">*</span></label>
          <div class="flex justify-between"><label class="flex items-center space-x-2"> <input type="radio" name="three_way" value="‚úì" class="w-4 h-4 md:w-5 md:h-5 text-emerald-600" required> <span class="text-green-600 text-base md:text-lg">‚úì</span> </label> <label class="flex items-center space-x-2"> <input type="radio" name="three_way" value="‚úó" class="w-4 h-4 md:w-5 md:h-5 text-red-600" required> <span class="text-red-600 text-base md:text-lg">‚úó</span> </label>
          </div>
         </div>
         <div class="p-4 bg-white rounded-lg border"><label class="block text-base md:text-lg font-medium text-gray-700 mb-3">üîå In jection plug 3 ‡∏≠‡∏±‡∏ô <span class="text-red-500">*</span></label>
          <div class="flex justify-between"><label class="flex items-center space-x-2"> <input type="radio" name="injection_plug" value="‚úì" class="w-4 h-4 md:w-5 md:h-5 text-emerald-600" required> <span class="text-green-600 text-base md:text-lg">‚úì</span> </label> <label class="flex items-center space-x-2"> <input type="radio" name="injection_plug" value="‚úó" class="w-4 h-4 md:w-5 md:h-5 text-red-600" required> <span class="text-red-600 text-base md:text-lg">‚úó</span> </label>
          </div>
         </div>
         <div class="p-4 bg-white rounded-lg border"><label class="block text-base md:text-lg font-medium text-gray-700 mb-3">üíß sterline water 5 <span class="text-red-500">*</span></label>
          <div class="flex justify-between"><label class="flex items-center space-x-2"> <input type="radio" name="sterile_water" value="‚úì" class="w-4 h-4 md:w-5 md:h-5 text-emerald-600" required> <span class="text-green-600 text-base md:text-lg">‚úì</span> </label> <label class="flex items-center space-x-2"> <input type="radio" name="sterile_water" value="‚úó" class="w-4 h-4 md:w-5 md:h-5 text-red-600" required> <span class="text-red-600 text-base md:text-lg">‚úó</span> </label>
          </div>
         </div>
         <div class="p-4 bg-white rounded-lg border"><label class="block text-base md:text-lg font-medium text-gray-700 mb-3">ü©π Transpore 1 ‡∏ô‡∏¥‡πâ‡∏ß 2‡∏°‡πâ‡∏ß‡∏ô <span class="text-red-500">*</span></label>
          <div class="flex justify-between"><label class="flex items-center space-x-2"> <input type="radio" name="transpore" value="‚úì" class="w-4 h-4 md:w-5 md:h-5 text-emerald-600" required> <span class="text-green-600 text-base md:text-lg">‚úì</span> </label> <label class="flex items-center space-x-2"> <input type="radio" name="transpore" value="‚úó" class="w-4 h-4 md:w-5 md:h-5 text-red-600" required> <span class="text-red-600 text-base md:text-lg">‚úó</span> </label>
          </div>
         </div>
         <div class="p-4 bg-white rounded-lg border"><label class="block text-base md:text-lg font-medium text-gray-700 mb-3">ü©π ‡∏û‡∏•‡∏≤‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå‡πÄ‡∏´‡∏ô‡∏µ‡∏¢‡∏ß‡∏ï‡∏¥‡∏î Tube 10 ‡πÄ‡∏™‡πâ‡∏ô <span class="text-red-500">*</span></label>
          <div class="flex justify-between"><label class="flex items-center space-x-2"> <input type="radio" name="plaster_tube" value="‚úì" class="w-4 h-4 md:w-5 md:h-5 text-emerald-600" required> <span class="text-green-600 text-base md:text-lg">‚úì</span> </label> <label class="flex items-center space-x-2"> <input type="radio" name="plaster_tube" value="‚úó" class="w-4 h-4 md:w-5 md:h-5 text-red-600" required> <span class="text-red-600 text-base md:text-lg">‚úó</span> </label>
          </div>
         </div>
         <div class="p-4 bg-white rounded-lg border"><label class="block text-base md:text-lg font-medium text-gray-700 mb-3">‚úÇÔ∏è ‡∏Å‡∏£‡∏£‡πÑ‡∏Å‡∏£ 1 <span class="text-red-500">*</span></label>
          <div class="flex justify-between"><label class="flex items-center space-x-2"> <input type="radio" name="scissors" value="‚úì" class="w-4 h-4 md:w-5 md:h-5 text-emerald-600" required> <span class="text-green-600 text-base md:text-lg">‚úì</span> </label> <label class="flex items-center space-x-2"> <input type="radio" name="scissors" value="‚úó" class="w-4 h-4 md:w-5 md:h-5 text-red-600" required> <span class="text-red-600 text-base md:text-lg">‚úó</span> </label>
          </div>
         </div>
         <div class="p-4 bg-white rounded-lg border"><label class="block text-base md:text-lg font-medium text-gray-700 mb-3">üéóÔ∏è Tourniquet 2 ‡∏≠‡∏±‡∏ô <span class="text-red-500">*</span></label>
          <div class="flex justify-between"><label class="flex items-center space-x-2"> <input type="radio" name="tourniquet" value="‚úì" class="w-4 h-4 md:w-5 md:h-5 text-emerald-600" required> <span class="text-green-600 text-base md:text-lg">‚úì</span> </label> <label class="flex items-center space-x-2"> <input type="radio" name="tourniquet" value="‚úó" class="w-4 h-4 md:w-5 md:h-5 text-red-600" required> <span class="text-red-600 text-base md:text-lg">‚úó</span> </label>
          </div>
         </div>
         <div class="p-4 bg-white rounded-lg border"><label class="block text-base md:text-lg font-medium text-gray-700 mb-3">üß¥ ‡∏™‡∏≥‡∏•‡∏µ Alcohol 5 ‡∏≠‡∏±‡∏ô <span class="text-red-500">*</span></label>
          <div class="flex justify-between"><label class="flex items-center space-x-2"> <input type="radio" name="alcohol" value="‚úì" class="w-4 h-4 md:w-5 md:h-5 text-emerald-600" required> <span class="text-green-600 text-base md:text-lg">‚úì</span> </label> <label class="flex items-center space-x-2"> <input type="radio" name="alcohol" value="‚úó" class="w-4 h-4 md:w-5 md:h-5 text-red-600" required> <span class="text-red-600 text-base md:text-lg">‚úó</span> </label>
          </div>
         </div>
         <div class="p-4 bg-white rounded-lg border"><label class="block text-base md:text-lg font-medium text-gray-700 mb-3">ü™ö ‡πÉ‡∏ö‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏¢ 3 ‡∏≠‡∏±‡∏ô <span class="text-red-500">*</span></label>
          <div class="flex justify-between"><label class="flex items-center space-x-2"> <input type="radio" name="saw_blade" value="‚úì" class="w-4 h-4 md:w-5 md:h-5 text-emerald-600" required> <span class="text-green-600 text-base md:text-lg">‚úì</span> </label> <label class="flex items-center space-x-2"> <input type="radio" name="saw_blade" value="‚úó" class="w-4 h-4 md:w-5 md:h-5 text-red-600" required> <span class="text-red-600 text-base md:text-lg">‚úó</span> </label>
          </div>
         </div>
        </div>
       </div>
      </div><!-- Floor 2 -->
      <div class="bg-green-50 p-4 rounded-xl">
       <h3 class="font-bold text-green-800 mb-4 text-lg md:text-xl">‡∏ä‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà 2</h3>
       <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
        <div class="p-4 bg-white rounded-lg border"><label class="block text-base md:text-lg font-medium text-gray-700 mb-3">üî¨ Laryngoscope + Blade (‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ñ‡πà‡∏≤‡∏ô) 1 ‡∏ä‡∏∏‡∏î <span class="text-red-500">*</span></label>
         <div class="flex justify-between"><label class="flex items-center space-x-2"> <input type="radio" name="laryngoscope" value="‚úì" class="w-4 h-4 md:w-5 md:h-5 text-emerald-600" required> <span class="text-green-600 text-base md:text-lg">‚úì</span> </label> <label class="flex items-center space-x-2"> <input type="radio" name="laryngoscope" value="‚úó" class="w-4 h-4 md:w-5 md:h-5 text-red-600" required> <span class="text-red-600 text-base md:text-lg">‚úó</span> </label>
         </div>
        </div>
        <div class="p-4 bg-white rounded-lg border"><label class="block text-base md:text-lg font-medium text-gray-700 mb-3">üîß Magill Force(‡πÄ‡∏î‡πá‡∏Å/‡∏ú‡∏π‡πâ‡πÉ‡∏´‡∏ç‡πà) (1,1) <span class="text-red-500">*</span></label>
         <div class="flex justify-between"><label class="flex items-center space-x-2"> <input type="radio" name="magill_force" value="‚úì" class="w-4 h-4 md:w-5 md:h-5 text-emerald-600" required> <span class="text-green-600 text-base md:text-lg">‚úì</span> </label> <label class="flex items-center space-x-2"> <input type="radio" name="magill_force" value="‚úó" class="w-4 h-4 md:w-5 md:h-5 text-red-600" required> <span class="text-red-600 text-base md:text-lg">‚úó</span> </label>
         </div>
        </div>
        <div class="p-4 bg-white rounded-lg border"><label class="block text-base md:text-lg font-medium text-gray-700 mb-3">üìè Guide wire (‡πÄ‡∏î‡πá‡∏Å/‡πÄ‡∏î‡πá‡∏Å‡πÇ‡∏ï/‡∏ú‡∏π‡πâ‡πÉ‡∏´‡∏ç‡πà) (1,1,4) <span class="text-red-500">*</span></label>
         <div class="flex justify-between"><label class="flex items-center space-x-2"> <input type="radio" name="guide_wire" value="‚úì" class="w-4 h-4 md:w-5 md:h-5 text-emerald-600" required> <span class="text-green-600 text-base md:text-lg">‚úì</span> </label> <label class="flex items-center space-x-2"> <input type="radio" name="guide_wire" value="‚úó" class="w-4 h-4 md:w-5 md:h-5 text-red-600" required> <span class="text-red-600 text-base md:text-lg">‚úó</span> </label>
         </div>
        </div>
        <div class="p-4 bg-white rounded-lg border"><label class="block text-base md:text-lg font-medium text-gray-700 mb-3">üß¥ K-Y Jelly 1 <span class="text-red-500">*</span></label>
         <div class="flex justify-between"><label class="flex items-center space-x-2"> <input type="radio" name="ky_jelly" value="‚úì" class="w-4 h-4 md:w-5 md:h-5 text-emerald-600" required> <span class="text-green-600 text-base md:text-lg">‚úì</span> </label> <label class="flex items-center space-x-2"> <input type="radio" name="ky_jelly" value="‚úó" class="w-4 h-4 md:w-5 md:h-5 text-red-600" required> <span class="text-red-600 text-base md:text-lg">‚úó</span> </label>
         </div>
        </div>
        <div class="p-4 bg-white rounded-lg border"><label class="block text-base md:text-lg font-medium text-gray-700 mb-3">ü•£ ‡∏ä‡∏≤‡∏°‡∏£‡∏π‡∏õ‡πÑ‡∏ï 1 <span class="text-red-500">*</span></label>
         <div class="flex justify-between"><label class="flex items-center space-x-2"> <input type="radio" name="kidney_bowl" value="‚úì" class="w-4 h-4 md:w-5 md:h-5 text-emerald-600" required> <span class="text-green-600 text-base md:text-lg">‚úì</span> </label> <label class="flex items-center space-x-2"> <input type="radio" name="kidney_bowl" value="‚úó" class="w-4 h-4 md:w-5 md:h-5 text-red-600" required> <span class="text-red-600 text-base md:text-lg">‚úó</span> </label>
         </div>
        </div>
        <div class="p-4 bg-white rounded-lg border"><label class="block text-base md:text-lg font-medium text-gray-700 mb-3">üíß 0.9 % NSS (1,000 ml ,500 ml )(2 ,2) <span class="text-red-500">*</span></label>
         <div class="flex justify-between"><label class="flex items-center space-x-2"> <input type="radio" name="nss" value="‚úì" class="w-4 h-4 md:w-5 md:h-5 text-emerald-600" required> <span class="text-green-600 text-base md:text-lg">‚úì</span> </label> <label class="flex items-center space-x-2"> <input type="radio" name="nss" value="‚úó" class="w-4 h-4 md:w-5 md:h-5 text-red-600" required> <span class="text-red-600 text-base md:text-lg">‚úó</span> </label>
         </div>
        </div>
        <div class="p-4 bg-white rounded-lg border"><label class="block text-base md:text-lg font-medium text-gray-700 mb-3">üçØ 5% DW 100 ml 2 ‡∏Ç‡∏ß‡∏î <span class="text-red-500">*</span></label>
         <div class="flex justify-between"><label class="flex items-center space-x-2"> <input type="radio" name="d5w" value="‚úì" class="w-4 h-4 md:w-5 md:h-5 text-emerald-600" required> <span class="text-green-600 text-base md:text-lg">‚úì</span> </label> <label class="flex items-center space-x-2"> <input type="radio" name="d5w" value="‚úó" class="w-4 h-4 md:w-5 md:h-5 text-red-600" required> <span class="text-red-600 text-base md:text-lg">‚úó</span> </label>
         </div>
        </div>
       </div>
      </div><!-- Floor 3 -->
      <div class="bg-purple-50 p-4 rounded-xl">
       <h3 class="font-bold text-purple-800 mb-4 text-lg md:text-xl">‡∏ä‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà 3</h3>
       <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
        <div class="p-4 bg-white rounded-lg border"><label class="block text-base md:text-lg font-medium text-gray-700 mb-3">ü´Å ET-Tube No.3, 3.5, 4,4.5 ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏•‡∏∞ 1 <span class="text-red-500">*</span></label>
         <div class="flex justify-between"><label class="flex items-center space-x-2"> <input type="radio" name="et_tube_a" value="‚úì" class="w-4 h-4 md:w-5 md:h-5 text-emerald-600" required> <span class="text-green-600 text-base md:text-lg">‚úì</span> </label> <label class="flex items-center space-x-2"> <input type="radio" name="et_tube_a" value="‚úó" class="w-4 h-4 md:w-5 md:h-5 text-red-600" required> <span class="text-red-600 text-base md:text-lg">‚úó</span> </label>
         </div>
        </div>
        <div class="p-4 bg-white rounded-lg border"><label class="block text-base md:text-lg font-medium text-gray-700 mb-3">ü´Å ET-Tube No.5, 5.5, 6,6.5,8.5 ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏•‡∏∞ 1 <span class="text-red-500">*</span></label>
         <div class="flex justify-between"><label class="flex items-center space-x-2"> <input type="radio" name="et_tube_b" value="‚úì" class="w-4 h-4 md:w-5 md:h-5 text-emerald-600" required> <span class="text-green-600 text-base md:text-lg">‚úì</span> </label> <label class="flex items-center space-x-2"> <input type="radio" name="et_tube_b" value="‚úó" class="w-4 h-4 md:w-5 md:h-5 text-red-600" required> <span class="text-red-600 text-base md:text-lg">‚úó</span> </label>
         </div>
        </div>
        <div class="p-4 bg-white rounded-lg border"><label class="block text-base md:text-lg font-medium text-gray-700 mb-3">ü´Å ET-Tube No.7, 7.5, 8 ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏•‡∏∞ 2 <span class="text-red-500">*</span></label>
         <div class="flex justify-between"><label class="flex items-center space-x-2"> <input type="radio" name="et_tube_c" value="‚úì" class="w-4 h-4 md:w-5 md:h-5 text-emerald-600" required> <span class="text-green-600 text-base md:text-lg">‚úì</span> </label> <label class="flex items-center space-x-2"> <input type="radio" name="et_tube_c" value="‚úó" class="w-4 h-4 md:w-5 md:h-5 text-red-600" required> <span class="text-red-600 text-base md:text-lg">‚úó</span> </label>
         </div>
        </div>
       </div>
      </div><!-- Floor 4 -->
      <div class="bg-orange-50 p-4 rounded-xl">
       <h3 class="font-bold text-orange-800 mb-4">‡∏ä‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà 4</h3>
       <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
        <div class="p-4 bg-white rounded-lg border"><label class="block text-base md:text-lg font-medium text-gray-700 mb-3">ü´Å Orol Airway No 4,5,6 ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏•‡∏∞ 1 ‡∏≠‡∏±‡∏ô <span class="text-red-500">*</span></label>
         <div class="flex justify-between"><label class="flex items-center space-x-2"> <input type="radio" name="oral_airway_a" value="‚úì" class="w-4 h-4 md:w-5 md:h-5 text-emerald-600" required> <span class="text-green-600 text-base md:text-lg">‚úì</span> </label> <label class="flex items-center space-x-2"> <input type="radio" name="oral_airway_a" value="‚úó" class="w-4 h-4 md:w-5 md:h-5 text-red-600" required> <span class="text-red-600 text-base md:text-lg">‚úó</span> </label>
         </div>
        </div>
        <div class="p-4 bg-white rounded-lg border"><label class="block text-base md:text-lg font-medium text-gray-700 mb-3">ü´Å Orol Airway No 7,8,9,10 ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏•‡∏∞ 3 ‡∏≠‡∏±‡∏ô <span class="text-red-500">*</span></label>
         <div class="flex justify-between"><label class="flex items-center space-x-2"> <input type="radio" name="oral_airway_b" value="‚úì" class="w-4 h-4 md:w-5 md:h-5 text-emerald-600" required> <span class="text-green-600 text-base md:text-lg">‚úì</span> </label> <label class="flex items-center space-x-2"> <input type="radio" name="oral_airway_b" value="‚úó" class="w-4 h-4 md:w-5 md:h-5 text-red-600" required> <span class="text-red-600 text-base md:text-lg">‚úó</span> </label>
         </div>
        </div>
        <div class="p-4 bg-white rounded-lg border"><label class="block text-base md:text-lg font-medium text-gray-700 mb-3">üî¶ ‡πÑ‡∏ü‡∏â‡∏≤‡∏¢ 1 <span class="text-red-500">*</span></label>
         <div class="flex justify-between"><label class="flex items-center space-x-2"> <input type="radio" name="flashlight" value="‚úì" class="w-4 h-4 md:w-5 md:h-5 text-emerald-600" required> <span class="text-green-600 text-base md:text-lg">‚úì</span> </label> <label class="flex items-center space-x-2"> <input type="radio" name="flashlight" value="‚úó" class="w-4 h-4 md:w-5 md:h-5 text-red-600" required> <span class="text-red-600 text-base md:text-lg">‚úó</span> </label>
         </div>
        </div>
        <div class="p-4 bg-white rounded-lg border"><label class="block text-base md:text-lg font-medium text-gray-700 mb-3">üëì ‡πÅ‡∏ß‡πà‡∏ô‡∏ï‡∏≤ 1 <span class="text-red-500">*</span></label>
         <div class="flex justify-between"><label class="flex items-center space-x-2"> <input type="radio" name="glasses" value="‚úì" class="w-4 h-4 md:w-5 md:h-5 text-emerald-600" required> <span class="text-green-600 text-base md:text-lg">‚úì</span> </label> <label class="flex items-center space-x-2"> <input type="radio" name="glasses" value="‚úó" class="w-4 h-4 md:w-5 md:h-5 text-red-600" required> <span class="text-red-600 text-base md:text-lg">‚úó</span> </label>
         </div>
        </div>
       </div>
      </div><!-- Floor 5 -->
      <div class="bg-pink-50 p-4 rounded-xl">
       <h3 class="font-bold text-pink-800 mb-4">‡∏ä‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà 5</h3>
       <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
        <div class="p-4 bg-white rounded-lg border"><label class="block text-base md:text-lg font-medium text-gray-700 mb-3">üò∑ Mask No 0,1,2,3 ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏•‡∏∞ 1 <span class="text-red-500">*</span></label>
         <div class="flex justify-between"><label class="flex items-center space-x-2"> <input type="radio" name="mask_a" value="‚úì" class="w-4 h-4 md:w-5 md:h-5 text-emerald-600" required> <span class="text-green-600 text-base md:text-lg">‚úì</span> </label> <label class="flex items-center space-x-2"> <input type="radio" name="mask_a" value="‚úó" class="w-4 h-4 md:w-5 md:h-5 text-red-600" required> <span class="text-red-600 text-base md:text-lg">‚úó</span> </label>
         </div>
        </div>
        <div class="p-4 bg-white rounded-lg border"><label class="block text-base md:text-lg font-medium text-gray-700 mb-3">üò∑ Mask No 4,5 ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏•‡∏∞ 2 <span class="text-red-500">*</span></label>
         <div class="flex justify-between"><label class="flex items-center space-x-2"> <input type="radio" name="mask_b" value="‚úì" class="w-4 h-4 md:w-5 md:h-5 text-emerald-600" required> <span class="text-green-600 text-base md:text-lg">‚úì</span> </label> <label class="flex items-center space-x-2"> <input type="radio" name="mask_b" value="‚úó" class="w-4 h-4 md:w-5 md:h-5 text-red-600" required> <span class="text-red-600 text-base md:text-lg">‚úó</span> </label>
         </div>
        </div>
        <div class="p-4 bg-white rounded-lg border"><label class="block text-base md:text-lg font-medium text-gray-700 mb-3">ü´Å Ambu bag (‡πÄ‡∏î‡πá‡∏Å‡πÄ‡∏•‡πá‡∏Å/‡πÄ‡∏î‡πá‡∏Å‡πÇ‡∏ï/‡∏ú‡∏π‡πâ‡πÉ‡∏´‡∏ç‡πà) ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏•‡∏∞ 1 ‡∏ä‡∏∏‡∏î <span class="text-red-500">*</span></label>
         <div class="flex justify-between"><label class="flex items-center space-x-2"> <input type="radio" name="ambu_bag" value="‚úì" class="w-4 h-4 md:w-5 md:h-5 text-emerald-600" required> <span class="text-green-600 text-base md:text-lg">‚úì</span> </label> <label class="flex items-center space-x-2"> <input type="radio" name="ambu_bag" value="‚úó" class="w-4 h-4 md:w-5 md:h-5 text-red-600" required> <span class="text-red-600 text-base md:text-lg">‚úó</span> </label>
         </div>
        </div>
        <div class="p-4 bg-white rounded-lg border"><label class="block text-base md:text-lg font-medium text-gray-700 mb-3">ü´Å ‡∏™‡∏≤‡∏¢‡∏ï‡πà‡∏≠‡∏≠‡∏≠‡∏Å‡∏ã‡∏¥‡πÄ‡∏à‡∏ô 1 ‡πÄ‡∏™‡πâ‡∏ô <span class="text-red-500">*</span></label>
         <div class="flex justify-between"><label class="flex items-center space-x-2"> <input type="radio" name="o2_tube" value="‚úì" class="w-4 h-4 md:w-5 md:h-5 text-emerald-600" required> <span class="text-green-600 text-base md:text-lg">‚úì</span> </label> <label class="flex items-center space-x-2"> <input type="radio" name="o2_tube" value="‚úó" class="w-4 h-4 md:w-5 md:h-5 text-red-600" required> <span class="text-red-600 text-base md:text-lg">‚úó</span> </label>
         </div>
        </div>
       </div>
      </div><!-- Inspector Info -->
      <div class="bg-gray-50 p-4 rounded-xl">
       <h3 class="font-bold text-gray-800 mb-4 text-lg md:text-xl">üë§ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</h3>
       <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
         <div class="flex items-center justify-between mb-3"><label for="inspector" class="block text-base md:text-lg font-semibold text-gray-700">‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö <span class="text-red-500">*</span></label> <button type="button" id="manage-inspectors-btn" class="text-sm md:text-base bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-lg transition-colors"> ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ </button>
         </div><select id="inspector" class="w-full px-4 py-4 border-2 border-gray-200 rounded-xl focus:border-emerald-500 focus:outline-none transition-colors text-base md:text-lg" required> <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</option> <!-- Options will be loaded from Name sheet --> </select>
        </div>
        <div><label for="signature" class="block text-base md:text-lg font-semibold text-gray-700 mb-3">‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡∏ä‡∏∑‡πà‡∏≠ <span class="text-red-500">*</span></label>
         <canvas id="signature-pad" class="w-full h-28 md:h-32 border-2 border-gray-200 rounded-xl bg-white cursor-crosshair" required></canvas>
         <div class="flex gap-2 mt-2"><button type="button" id="clear-signature" class="text-sm md:text-base bg-gray-200 hover:bg-gray-300 px-4 py-2 rounded-lg">‡∏•‡πâ‡∏≤‡∏á‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡∏ä‡∏∑‡πà‡∏≠</button>
         </div>
        </div>
       </div>
      </div><!-- Submit Button -->
      <div class="flex justify-end"><button type="submit" id="submit-inspection" class="bg-emerald-500 hover:bg-emerald-600 text-white font-semibold py-4 px-8 rounded-xl transition-all duration-200 flex items-center gap-3 shadow-md text-base md:text-lg">
        <svg class="w-5 h-5 md:w-6 md:h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
        </svg> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö </button>
      </div>
     </div>
    </form>
   </div><!-- Inspection Records Table -->
   <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
    <div class="p-6 border-b border-gray-200">
     <div class="flex flex-col gap-4">
      <h2 class="text-xl font-bold text-gray-800 flex items-center gap-2"><span class="text-2xl">üìä</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏ñ Emergency</h2>
      <div class="flex flex-col sm:flex-row items-start sm:items-center gap-3"><span class="text-sm font-medium text-gray-600 whitespace-nowrap">‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:</span>
       <div class="flex flex-col sm:flex-row gap-3 w-full sm:w-auto"><select id="month-filter" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 text-sm md:text-base min-w-[120px]"> <option value="">‡∏ó‡∏∏‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</option> </select> <select id="year-filter" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 text-sm md:text-base min-w-[100px]"> <option value="">‡∏ó‡∏∏‡∏Å‡∏õ‡∏µ</option> </select>
       </div>
      </div>
     </div>
    </div>
    <div class="p-6">
     <div class="overflow-x-auto">
      <table class="w-full bg-white rounded-2xl overflow-hidden shadow-sm border border-gray-100">
       <thead class="bg-gradient-to-r from-emerald-500 to-emerald-600 text-white">
       <thead class="bg-gradient-to-r from-emerald-500 to-emerald-600 text-white">
        <tr>
         <th class="px-6 py-3 text-center font-semibold rounded-tl-2xl">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
         <th class="px-6 py-3 text-center font-semibold">‡πÄ‡∏ß‡∏£</th>
         <th class="px-6 py-3 text-center font-semibold">‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</th>
         <th class="px-6 py-3 text-center font-semibold">‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡∏ä‡∏∑‡πà‡∏≠</th>
         <th class="px-6 py-3 text-center font-semibold rounded-tr-2xl">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
        </tr>
       </thead>
       <tbody id="inspection-table-body" class="divide-y divide-gray-100"><!-- Inspection records will be inserted here -->
       </tbody>
      </table>
     </div>
    </div>
    <div id="inspection-empty-state" class="text-center py-12 text-gray-400 hidden">
     <svg class="w-16 h-16 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
     </svg>
     <p class="text-lg font-medium">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</p>
     <p class="text-sm">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</p>
    </div>
   </div>
  </div><!-- Add/Edit Medicine Modal -->
  <div id="medicine-modal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop hidden z-50 flex items-center justify-center p-4">
   <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full max-h-[90vh] overflow-y-auto">
    <div class="p-6 border-b border-gray-200">
     <div class="flex items-center justify-between">
      <h3 id="modal-title" class="text-xl font-bold text-gray-800">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏¢‡∏≤/‡πÄ‡∏ß‡∏ä‡∏†‡∏±‡∏ì‡∏ë‡πå‡πÉ‡∏´‡∏°‡πà</h3><button id="close-modal" class="text-gray-400 hover:text-gray-600 p-2">
       <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
       </svg></button>
     </div>
    </div>
    <form id="medicine-form" class="p-6 space-y-4">
     <div><label for="medicine-name" class="block text-sm font-semibold text-gray-700 mb-2">üíä ‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤/‡πÄ‡∏ß‡∏ä‡∏†‡∏±‡∏ì‡∏ë‡πå</label> <input type="text" id="medicine-name" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-emerald-500 focus:outline-none transition-colors">
     </div>
     <div><label for="medicine-type" class="block text-sm font-semibold text-gray-700 mb-2">üè• ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label> <select id="medicine-type" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-emerald-500 focus:outline-none transition-colors"> <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</option> <option value="‡∏¢‡∏≤">üíä ‡∏¢‡∏≤</option> <option value="‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå">üè• ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå</option> </select>
     </div>
     <div><label for="expiry-date" class="block text-sm font-semibold text-gray-700 mb-2">üìÖ ‡∏ß‡∏±‡∏ô‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏</label> <input type="date" id="expiry-date" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-emerald-500 focus:outline-none transition-colors">
     </div>
     <div class="flex gap-3 pt-4"><button type="button" id="cancel-btn" class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-3 px-6 rounded-xl transition-colors"> ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å </button> <button type="submit" id="save-btn" class="flex-1 bg-emerald-500 hover:bg-emerald-600 text-white font-semibold py-3 px-6 rounded-xl transition-colors"> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å </button>
     </div>
    </form>
   </div>
  </div><!-- Detail Modal -->
  <div id="detail-modal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop hidden z-50 flex items-center justify-center p-4">
   <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full">
    <div class="p-6 border-b border-gray-200">
     <div class="flex items-center justify-between">
      <h3 class="text-xl font-bold text-gray-800">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</h3><button id="close-detail-modal" class="text-gray-400 hover:text-gray-600 p-2">
       <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
       </svg></button>
     </div>
    </div>
    <div id="detail-content" class="p-6 space-y-4"><!-- Detail content will be inserted here -->
    </div>
   </div>
  </div><!-- Inspection Detail Modal -->
  <div id="inspection-detail-modal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop hidden z-50 flex items-center justify-center p-4">
   <div class="bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
    <div class="p-6 border-b border-gray-200">
     <div class="flex items-center justify-between">
      <h3 class="text-xl font-bold text-gray-800">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</h3><button id="close-inspection-detail-modal" class="text-gray-400 hover:text-gray-600 p-2">
       <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
       </svg></button>
     </div>
    </div>
    <div id="inspection-detail-content" class="p-6"><!-- Inspection detail content will be inserted here -->
    </div>
   </div>
  </div><!-- Inspector Management Modal -->
  <div id="inspector-modal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop hidden z-50 flex items-center justify-center p-4">
   <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full max-h-[90vh] overflow-y-auto">
    <div class="p-6 border-b border-gray-200">
     <div class="flex items-center justify-between">
      <h3 class="text-xl font-bold text-gray-800">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</h3><button id="close-inspector-modal" class="text-gray-400 hover:text-gray-600 p-2">
       <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
       </svg></button>
     </div>
    </div>
    <div class="p-6"><!-- Add New Inspector -->
     <div class="mb-6">
      <h4 class="font-semibold text-gray-800 mb-3">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà</h4>
      <form id="add-inspector-form" class="flex gap-2"><input type="text" id="new-inspector-name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500" required> <button type="submit" class="bg-emerald-500 hover:bg-emerald-600 text-white px-4 py-2 rounded-lg transition-colors"> ‡πÄ‡∏û‡∏¥‡πà‡∏° </button>
      </form>
     </div><!-- Inspector List -->
     <div>
      <h4 class="font-semibold text-gray-800 mb-3">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</h4>
      <div id="inspector-list" class="space-y-2 max-h-60 overflow-y-auto"><!-- Inspector items will be inserted here -->
      </div>
     </div>
    </div>
   </div>
  </div>
  <script>
    const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwcJa3-8g1JapmSeLrzEV96eXuu8eW-JtodLbe_r5jVi2Z1-WfhMWI1SXQOGlqNJS5qhg/exec';
    const INSPECTION_SHEET_URL = 'https://script.google.com/macros/s/AKfycbwcJa3-8g1JapmSeLrzEV96eXuu8eW-JtodLbe_r5jVi2Z1-WfhMWI1SXQOGlqNJS5qhg/exec';
    const SPREADSHEET_ID = '1Au3QkeLFDqBCK7gSCGVVL80XNiMznzT6z69pf2t2k-E';
    const SIGNATURE_FOLDER_ID = '1ppfoFOfuZCZwnJGt1Jwn14c_v0B69DIn';
    
    const defaultConfig = {
      app_title: '‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏¢‡∏≤‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏ä‡∏†‡∏±‡∏ì‡∏ë‡πå‡∏£‡∏ñ Emergency',
      add_button_text: '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏¢‡∏≤/‡πÄ‡∏ß‡∏ä‡∏†‡∏±‡∏ì‡∏ë‡πå‡πÉ‡∏´‡∏°‡πà',
      primary_color: '#10b981',
      surface_color: '#ffffff',
      text_color: '#1f2937',
      font_family: 'Prompt',
      font_size: 16
    };

    let allMedicines = [];
    let editingMedicine = null;
    let signaturePad = null;
    let inspectorNames = [];
    let allInspections = [];
    let editingInspection = null;

    function updateConnectionStatus(status, message) {
      const indicator = document.getElementById('status-indicator');
      const text = document.getElementById('status-text');
      
      if (status === 'connected') {
        indicator.className = 'w-2 h-2 rounded-full bg-green-500';
        text.textContent = message || '‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à';
        text.className = 'text-green-600';
      } else if (status === 'error') {
        indicator.className = 'w-2 h-2 rounded-full bg-red-500';
        text.textContent = message || '‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à';
        text.className = 'text-red-600';
      } else if (status === 'loading') {
        indicator.className = 'w-2 h-2 rounded-full bg-yellow-500 animate-pulse';
        text.textContent = message || '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets...';
        text.className = 'text-yellow-600';
      } else {
        indicator.className = 'w-2 h-2 rounded-full bg-gray-400';
        text.textContent = message || '‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets';
        text.className = 'text-gray-600';
      }
    }

    function calculateDaysAndStatus(expiryDate, type) {
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      const expiry = new Date(expiryDate);
      expiry.setHours(0, 0, 0, 0);
      
      const diffTime = expiry - today;
      const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
      
      let status = '‡∏õ‡∏Å‡∏ï‡∏¥';
      let exchangeDate = new Date(expiry);
      
      if (type === '‡∏¢‡∏≤') {
        exchangeDate.setMonth(exchangeDate.getMonth() - 7); // 7 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏
        
        if (diffDays < 1) {
          status = '‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡∏´‡πâ‡∏≤‡∏°‡πÉ‡∏ä‡πâ';
        } else if (diffDays <= 6) {
          status = '‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏';
        } else if (diffDays <= 210) { // 7 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô = 210 ‡∏ß‡∏±‡∏ô
          status = '‡∏Ñ‡∏ß‡∏£‡πÅ‡∏•‡∏Å‡∏¢‡∏≤';
        }
      } else { // ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå
        exchangeDate.setDate(exchangeDate.getDate() - 14); // 14 ‡∏ß‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏
        
        if (diffDays <= 1) {
          status = '‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏';
        } else if (diffDays <= 7) {
          status = '‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏';
        } else if (diffDays <= 14) {
          status = '‡∏Ñ‡∏ß‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå';
        }
      }
      
      return {
        daysRemaining: diffDays,
        status: status,
        exchangeDate: exchangeDate.toISOString().split('T')[0]
      };
    }

    function getStatusColor(status) {
      if (!status) return 'bg-gray-100 text-gray-700 border-gray-200';
      
      if (status.includes('‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏') || status === '‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡∏´‡πâ‡∏≤‡∏°‡πÉ‡∏ä‡πâ') {
        return 'bg-red-100 text-red-700 border-red-200';
      } else if (status.includes('‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏') || status.includes('‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏')) {
        return 'bg-yellow-100 text-yellow-700 border-yellow-200';
      } else if (status.includes('‡∏Ñ‡∏ß‡∏£')) {
        return 'bg-orange-100 text-orange-700 border-orange-200';
      }
      return 'bg-emerald-100 text-emerald-700 border-emerald-200';
    }

    function renderMedicineTable(medicines) {
      const tableBody = document.getElementById('medicine-table-body');
      const emptyState = document.getElementById('empty-state');
      
      if (!medicines || medicines.length === 0) {
        tableBody.innerHTML = '';
        emptyState.classList.remove('hidden');
        return;
      }
      
      emptyState.classList.add('hidden');
      
      // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡πÅ‡∏î‡∏á -> ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á -> ‡∏™‡πâ‡∏° -> ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß
      const statusOrder = {
        '‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡∏´‡πâ‡∏≤‡∏°‡πÉ‡∏ä‡πâ': 1,
        '‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏': 1,
        '‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏': 2,
        '‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏': 2,
        '‡∏Ñ‡∏ß‡∏£‡πÅ‡∏•‡∏Å‡∏¢‡∏≤': 3,
        '‡∏Ñ‡∏ß‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå': 3,
        '‡∏õ‡∏Å‡∏ï‡∏¥': 4
      };
      
      const sortedMedicines = [...medicines].sort((a, b) => {
        const orderA = statusOrder[a.status] || 4;
        const orderB = statusOrder[b.status] || 4;
        if (orderA !== orderB) return orderA - orderB;
        return a.days_remaining - b.days_remaining;
      });
      
      tableBody.innerHTML = sortedMedicines.map((medicine, index) => `
        <tr class="hover:bg-gray-50 transition-all duration-200 ${index === sortedMedicines.length - 1 ? 'rounded-b-2xl' : ''}" data-row-index="${index}">
          <td class="px-6 py-3 ${index === sortedMedicines.length - 1 ? 'rounded-bl-2xl' : ''}">
            <div>
              <div class="font-semibold text-gray-800">${medicine.medicine_name || ''}</div>
              <div class="text-xs text-gray-500">
                ${medicine.expiry_date ? new Date(medicine.expiry_date).toLocaleDateString('th-TH', { day: '2-digit', month: '2-digit', year: 'numeric' }) : ''}
              </div>
            </div>
          </td>
          <td class="px-6 py-3 text-center">
            <div class="inline-flex flex-col items-center">
              <div class="font-bold text-xl ${medicine.days_remaining <= 7 ? 'text-red-600' : medicine.days_remaining <= 30 ? 'text-yellow-600' : 'text-emerald-600'}">
                ${medicine.days_remaining || 0}
              </div>
            </div>
          </td>
          <td class="px-6 py-3 text-center">
            <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold ${getStatusColor(medicine.status)} shadow-sm">
              ${medicine.status || '‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö'}
            </span>
          </td>
          <td class="px-6 py-3 text-center ${index === sortedMedicines.length - 1 ? 'rounded-br-2xl' : ''}">
            <div class="flex items-center justify-center gap-1">
              <button class="view-btn bg-blue-100 hover:bg-blue-200 text-blue-600 p-3 rounded-lg transition-all duration-200 hover:scale-105 shadow-sm touch-manipulation" data-row-index="${index}" title="‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                </svg>
              </button>
              <button class="edit-btn bg-emerald-100 hover:bg-emerald-200 text-emerald-600 p-3 rounded-lg transition-all duration-200 hover:scale-105 shadow-sm touch-manipulation" data-row-index="${index}" title="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                </svg>
              </button>
              <button class="delete-btn bg-red-100 hover:bg-red-200 text-red-600 p-3 rounded-lg transition-all duration-200 hover:scale-105 shadow-sm touch-manipulation" data-row-index="${index}" title="‡∏•‡∏ö">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                </svg>
              </button>
            </div>
          </td>
        </tr>
      `).join('');
      
      // Add event listeners
      document.querySelectorAll('.view-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const rowIndex = parseInt(e.currentTarget.getAttribute('data-row-index'));
          const medicine = sortedMedicines[rowIndex];
          if (medicine) showDetailModal(medicine);
        });
      });
      
      document.querySelectorAll('.edit-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const rowIndex = parseInt(e.currentTarget.getAttribute('data-row-index'));
          const medicine = sortedMedicines[rowIndex];
          if (medicine) showEditModal(medicine);
        });
      });
      
      document.querySelectorAll('.delete-btn').forEach(btn => {
        btn.addEventListener('click', async (e) => {
          const rowIndex = parseInt(e.currentTarget.getAttribute('data-row-index'));
          const medicine = sortedMedicines[rowIndex];
          if (medicine) await deleteMedicine(medicine);
        });
      });
    }

    function showDetailModal(medicine) {
      const modal = document.getElementById('detail-modal');
      const content = document.getElementById('detail-content');
      
      content.innerHTML = `
        <div class="space-y-4">
          <div class="flex items-center gap-3 p-4 bg-gray-50 rounded-xl">
            <span class="text-3xl">${medicine.type === '‡∏¢‡∏≤' ? 'üíä' : 'üè•'}</span>
            <div>
              <h4 class="font-bold text-lg">${medicine.medicine_name}</h4>
              <p class="text-sm text-gray-600">${medicine.type}</p>
            </div>
          </div>
          
          <div class="grid grid-cols-2 gap-4">
            <div class="p-3 bg-blue-50 rounded-lg">
              <p class="text-xs text-blue-600 font-semibold">‡∏ß‡∏±‡∏ô‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏</p>
              <p class="font-bold">${new Date(medicine.expiry_date).toLocaleDateString('th-TH', { year: 'numeric', month: 'long', day: 'numeric' })}</p>
            </div>
            
            <div class="p-3 bg-orange-50 rounded-lg">
              <p class="text-xs text-orange-600 font-semibold">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏•‡∏Å</p>
              <p class="font-bold">${new Date(medicine.exchange_date).toLocaleDateString('th-TH', { year: 'numeric', month: 'long', day: 'numeric' })}</p>
            </div>
            
            <div class="p-3 bg-emerald-50 rounded-lg">
              <p class="text-xs text-emerald-600 font-semibold">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠</p>
              <p class="font-bold text-2xl">${medicine.days_remaining} ‡∏ß‡∏±‡∏ô</p>
            </div>
            
            <div class="p-3 bg-purple-50 rounded-lg">
              <p class="text-xs text-purple-600 font-semibold">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</p>
              <span class="inline-block mt-1 px-3 py-1 rounded-full text-xs font-semibold border-2 ${getStatusColor(medicine.status)}">
                ${medicine.status}
              </span>
            </div>
          </div>
          
          <div class="p-3 bg-gray-50 rounded-lg">
            <p class="text-xs text-gray-600 font-semibold">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</p>
            <p class="font-bold">${new Date(medicine.recorded_at).toLocaleDateString('th-TH', { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' })}</p>
          </div>
        </div>
      `;
      
      modal.classList.remove('hidden');
    }

    function showEditModal(medicine = null) {
      editingMedicine = medicine;
      const modal = document.getElementById('medicine-modal');
      const title = document.getElementById('modal-title');
      const form = document.getElementById('medicine-form');
      
      title.textContent = medicine ? '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏¢‡∏≤/‡πÄ‡∏ß‡∏ä‡∏†‡∏±‡∏ì‡∏ë‡πå' : '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏¢‡∏≤/‡πÄ‡∏ß‡∏ä‡∏†‡∏±‡∏ì‡∏ë‡πå‡πÉ‡∏´‡∏°‡πà';
      
      if (medicine) {
        document.getElementById('medicine-name').value = medicine.medicine_name;
        document.getElementById('medicine-type').value = medicine.type;
        
        // Format date properly for input field (YYYY-MM-DD)
        let expiryDate = medicine.expiry_date;
        if (expiryDate) {
          // If it's an ISO string, extract just the date part
          if (expiryDate.includes('T')) {
            expiryDate = expiryDate.split('T')[0];
          }
          // If it's already in YYYY-MM-DD format, use as is
          document.getElementById('expiry-date').value = expiryDate;
        }
      } else {
        form.reset();
      }
      
      modal.classList.remove('hidden');
    }

    function hideModal() {
      document.getElementById('medicine-modal').classList.add('hidden');
      document.getElementById('detail-modal').classList.add('hidden');
      document.getElementById('inspector-modal').classList.add('hidden');
      editingMedicine = null;
    }

    // Google Sheets API Functions
    async function loadMedicines() {
      try {
        updateConnectionStatus('loading', '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...');
        
        // Use JSONP for loading data to avoid CORS issues
        return new Promise((resolve) => {
          const callbackName = 'load_callback_' + Math.round(100000 * Math.random());
          
          window[callbackName] = function(result) {
            delete window[callbackName];
            document.body.removeChild(script);
            
            try {
              if (result && result.success && result.data) {
                allMedicines = result.data.map((item, index) => {
                  // Ensure all required fields exist
                  const medicineData = {
                    id: item.id || (index + 2).toString(), // Use row number as ID
                    medicine_name: item.medicine_name || '',
                    type: item.type || '‡∏¢‡∏≤',
                    expiry_date: item.expiry_date || '',
                    exchange_date: item.exchange_date || '',
                    days_remaining: item.days_remaining || 0,
                    status: item.status || '‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö',
                    recorded_at: item.recorded_at || new Date().toISOString()
                  };
                  
                  // Recalculate if needed
                  if (medicineData.expiry_date && medicineData.type) {
                    const { daysRemaining, status, exchangeDate } = calculateDaysAndStatus(medicineData.expiry_date, medicineData.type);
                    medicineData.days_remaining = daysRemaining;
                    medicineData.status = status;
                    medicineData.exchange_date = exchangeDate;
                  }
                  
                  return medicineData;
                });
                
                renderMedicineTable(allMedicines);
                updateConnectionStatus('connected', '‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
              } else {
                allMedicines = [];
                renderMedicineTable(allMedicines);
                updateConnectionStatus('connected', '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•');
              }
            } catch (error) {
              console.error('Process data error:', error);
              allMedicines = [];
              renderMedicineTable(allMedicines);
              updateConnectionStatus('error', '‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
            }
            resolve();
          };
          
          const script = document.createElement('script');
          script.src = `${GOOGLE_SCRIPT_URL}?action=load&callback=${callbackName}&t=${Date.now()}`;
          script.onerror = () => {
            delete window[callbackName];
            document.body.removeChild(script);
            console.error('Script loading failed');
            updateConnectionStatus('error', '‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
            allMedicines = [];
            renderMedicineTable(allMedicines);
            resolve();
          };
          
          document.body.appendChild(script);
          
          // Timeout fallback
          setTimeout(() => {
            if (window[callbackName]) {
              delete window[callbackName];
              if (document.body.contains(script)) {
                document.body.removeChild(script);
              }
              console.log('Load timeout');
              updateConnectionStatus('error', '‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠');
              allMedicines = [];
              renderMedicineTable(allMedicines);
              resolve();
            }
          }, 10000);
        });
        
      } catch (error) {
        console.error('Load error:', error);
        updateConnectionStatus('error', '‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
        allMedicines = [];
        renderMedicineTable(allMedicines);
      }
    }

    async function saveMedicine(medicineData) {
      try {
        // Use form data to avoid CORS issues
        const formData = new FormData();
        formData.append('action', editingMedicine ? 'update' : 'create');
        formData.append('data', JSON.stringify(medicineData));
        if (editingMedicine) {
          formData.append('id', editingMedicine.id);
        }
        
        const response = await fetch(GOOGLE_SCRIPT_URL, {
          method: 'POST',
          body: formData
        });
        
        const result = await response.json();
        return result;
      } catch (error) {
        console.error('Save error:', error);
        return { success: false, error: error.message };
      }
    }

    async function deleteMedicine(medicine) {
      try {
        const result = await Swal.fire({
          title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö?',
          html: `‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö <strong>${medicine.medicine_name}</strong> ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?<br><small class="text-gray-500">‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÑ‡∏î‡πâ</small>`,
          icon: 'warning',
          showCancelButton: true,
          confirmButtonColor: '#ef4444',
          cancelButtonColor: '#6b7280',
          confirmButtonText: '‡∏•‡∏ö',
          cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
        });

        if (result.isConfirmed) {
          Swal.fire({
            title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...',
            allowOutsideClick: false,
            showConfirmButton: false,
            didOpen: () => Swal.showLoading()
          });
          
          // Use form data to avoid CORS issues
          const formData = new FormData();
          formData.append('action', 'delete');
          formData.append('id', medicine.id);
          
          const response = await fetch(GOOGLE_SCRIPT_URL, {
            method: 'POST',
            body: formData
          });
          
          const deleteResult = await response.json();
          
          if (deleteResult.success) {
            await loadMedicines();
            Swal.fire({
              icon: 'success',
              title: '‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
              timer: 1500,
              showConfirmButton: false
            });
          } else {
            Swal.fire({
              icon: 'error',
              title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
              text: deleteResult.error || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ'
            });
          }
        }
      } catch (error) {
        console.error('Delete error:', error);
        Swal.fire({
          icon: 'error',
          title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
          text: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ' + error.message
        });
      }
    }

    // Inspector Management Functions
    async function loadInspectorNames() {
      try {
        return new Promise((resolve) => {
          const callbackName = 'load_names_callback_' + Math.round(100000 * Math.random());
          
          window[callbackName] = function(result) {
            delete window[callbackName];
            document.body.removeChild(script);
            
            try {
              if (result && result.success && result.data) {
                inspectorNames = result.data;
              } else {
                inspectorNames = ['‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• A', '‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• B', '‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• C', '‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• D', '‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• E'];
              }
              
              updateInspectorSelect();
              renderInspectorList();
            } catch (error) {
              console.error('Process inspector names error:', error);
              inspectorNames = ['‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• A', '‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• B', '‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• C', '‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• D', '‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• E'];
              updateInspectorSelect();
              renderInspectorList();
            }
            resolve();
          };
          
          const script = document.createElement('script');
          script.src = `${GOOGLE_SCRIPT_URL}?action=load_names&callback=${callbackName}&t=${Date.now()}`;
          script.onerror = () => {
            delete window[callbackName];
            document.body.removeChild(script);
            console.error('Script loading failed');
            inspectorNames = ['‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• A', '‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• B', '‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• C', '‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• D', '‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• E'];
            updateInspectorSelect();
            renderInspectorList();
            resolve();
          };
          
          document.body.appendChild(script);
          
          // Timeout fallback
          setTimeout(() => {
            if (window[callbackName]) {
              delete window[callbackName];
              if (document.body.contains(script)) {
                document.body.removeChild(script);
              }
              console.log('Load inspector names timeout');
              inspectorNames = ['‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• A', '‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• B', '‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• C', '‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• D', '‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• E'];
              updateInspectorSelect();
              renderInspectorList();
              resolve();
            }
          }, 10000);
        });
        
      } catch (error) {
        console.error('Load inspector names error:', error);
        inspectorNames = ['‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• A', '‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• B', '‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• C', '‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• D', '‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• E'];
        updateInspectorSelect();
        renderInspectorList();
      }
    }

    function updateInspectorSelect() {
      const inspectorSelect = document.getElementById('inspector');
      const currentValue = inspectorSelect.value;
      
      inspectorSelect.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</option>';
      inspectorNames.forEach(name => {
        const option = document.createElement('option');
        option.value = name;
        option.textContent = name;
        inspectorSelect.appendChild(option);
      });
      
      // Restore previous selection if still exists
      if (currentValue && inspectorNames.includes(currentValue)) {
        inspectorSelect.value = currentValue;
      }
    }

    function renderInspectorList() {
      const inspectorList = document.getElementById('inspector-list');
      
      if (!inspectorNames || inspectorNames.length === 0) {
        inspectorList.innerHTML = '<p class="text-gray-500 text-center py-4">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</p>';
        return;
      }
      
      inspectorList.innerHTML = inspectorNames.map((name, index) => `
        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
          <span class="text-gray-800">${name}</span>
          <div class="flex gap-2">
            <button class="edit-inspector-btn text-blue-600 hover:text-blue-800 p-1" data-index="${index}" title="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
              </svg>
            </button>
            <button class="delete-inspector-btn text-red-600 hover:text-red-800 p-1" data-index="${index}" title="‡∏•‡∏ö">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
              </svg>
            </button>
          </div>
        </div>
      `).join('');
      
      // Add event listeners
      document.querySelectorAll('.edit-inspector-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const index = parseInt(e.currentTarget.getAttribute('data-index'));
          editInspectorName(index);
        });
      });
      
      document.querySelectorAll('.delete-inspector-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const index = parseInt(e.currentTarget.getAttribute('data-index'));
          deleteInspectorName(index);
        });
      });
    }

    async function addInspectorName(name) {
      try {
        Swal.fire({
          title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠...',
          allowOutsideClick: false,
          showConfirmButton: false,
          didOpen: () => Swal.showLoading()
        });

        // Use FormData to avoid CORS issues
        const formData = new FormData();
        formData.append('action', 'create_inspector');
        formData.append('data', JSON.stringify({ name: name }));
        
        const response = await fetch(GOOGLE_SCRIPT_URL, {
          method: 'POST',
          body: formData
        });
        
        const result = await response.json();
        
        if (result.success) {
          await loadInspectorNames();
          Swal.fire({
            icon: 'success',
            title: '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
            timer: 1500,
            showConfirmButton: false
          });
        } else {
          throw new Error(result.error || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏î‡πâ');
        }
      } catch (error) {
        console.error('Add inspector error:', error);
        Swal.fire({
          icon: 'error',
          title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
          text: error.message || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏î‡πâ'
        });
      }
    }

    async function editInspectorName(index) {
      const currentName = inspectorNames[index];
      
      const { value: newName } = await Swal.fire({
        title: '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö',
        input: 'text',
        inputValue: currentName,
        inputPlaceholder: '‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö',
        showCancelButton: true,
        confirmButtonText: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å',
        cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
        inputValidator: (value) => {
          if (!value || value.trim() === '') {
            return '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö';
          }
          if (value.trim() !== currentName && inspectorNames.includes(value.trim())) {
            return '‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß';
          }
        }
      });

      if (newName && newName.trim() !== currentName) {
        try {
          Swal.fire({
            title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠...',
            allowOutsideClick: false,
            showConfirmButton: false,
            didOpen: () => Swal.showLoading()
          });

          // Use FormData to avoid CORS issues
          const formData = new FormData();
          formData.append('action', 'update_inspector');
          formData.append('data', JSON.stringify({ old_name: currentName, new_name: newName.trim() }));
          
          const response = await fetch(GOOGLE_SCRIPT_URL, {
            method: 'POST',
            body: formData
          });
          
          const result = await response.json();
          
          if (result.success) {
            await loadInspectorNames();
            Swal.fire({
              icon: 'success',
              title: '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
              timer: 1500,
              showConfirmButton: false
            });
          } else {
            throw new Error(result.error || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏î‡πâ');
          }
        } catch (error) {
          console.error('Edit inspector error:', error);
          Swal.fire({
            icon: 'error',
            title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
            text: error.message || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏î‡πâ'
          });
        }
      }
    }

    async function deleteInspectorName(index) {
      const name = inspectorNames[index];
      
      const result = await Swal.fire({
        title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö?',
        html: `‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö <strong>${name}</strong> ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?<br><small class="text-gray-500">‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÑ‡∏î‡πâ</small>`,
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#ef4444',
        cancelButtonColor: '#6b7280',
        confirmButtonText: '‡∏•‡∏ö',
        cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
      });

      if (result.isConfirmed) {
        try {
          Swal.fire({
            title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠...',
            allowOutsideClick: false,
            showConfirmButton: false,
            didOpen: () => Swal.showLoading()
          });

          // Use FormData to avoid CORS issues
          const formData = new FormData();
          formData.append('action', 'delete_inspector');
          formData.append('data', JSON.stringify({ name: name }));
          
          const response = await fetch(GOOGLE_SCRIPT_URL, {
            method: 'POST',
            body: formData
          });
          
          const deleteResult = await response.json();
          
          if (deleteResult.success) {
            await loadInspectorNames();
            Swal.fire({
              icon: 'success',
              title: '‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
              timer: 1500,
              showConfirmButton: false
            });
          } else {
            throw new Error(deleteResult.error || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏î‡πâ');
          }
        } catch (error) {
          console.error('Delete inspector error:', error);
          Swal.fire({
            icon: 'error',
            title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
            text: error.message || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏î‡πâ'
          });
        }
      }
    }

    async function onConfigChange(config) {
      const appTitle = document.getElementById('app-title');
      const addButtonText = document.getElementById('add-button-text');
      
      appTitle.textContent = config.app_title || defaultConfig.app_title;
      addButtonText.textContent = config.add_button_text || defaultConfig.add_button_text;
      
      const customFont = config.font_family || defaultConfig.font_family;
      const baseSize = config.font_size || defaultConfig.font_size;
      const primaryColor = config.primary_color || defaultConfig.primary_color;
      
      document.body.style.fontFamily = `'${customFont}', sans-serif`;
      appTitle.style.fontSize = `${baseSize * 1.5}px`;
      
      document.querySelectorAll('.bg-emerald-500').forEach(el => {
        el.style.backgroundColor = primaryColor;
      });
    }

    // Event Listeners
    document.getElementById('add-medicine-btn').addEventListener('click', () => showEditModal());
    document.getElementById('close-modal').addEventListener('click', hideModal);
    document.getElementById('close-detail-modal').addEventListener('click', hideModal);
    document.getElementById('close-inspector-modal').addEventListener('click', hideModal);
    document.getElementById('cancel-btn').addEventListener('click', hideModal);

    // Inspector Management Event Listeners
    document.getElementById('manage-inspectors-btn').addEventListener('click', () => {
      document.getElementById('inspector-modal').classList.remove('hidden');
    });

    document.getElementById('add-inspector-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const nameInput = document.getElementById('new-inspector-name');
      const name = nameInput.value.trim();
      
      if (!name) {
        Swal.fire({
          icon: 'error',
          title: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô',
          text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö'
        });
        return;
      }
      
      if (inspectorNames.includes(name)) {
        Swal.fire({
          icon: 'error',
          title: '‡∏ä‡∏∑‡πà‡∏≠‡∏ã‡πâ‡∏≥',
          text: '‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß'
        });
        return;
      }
      
      await addInspectorName(name);
      nameInput.value = '';
    });

    document.getElementById('medicine-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const medicineName = document.getElementById('medicine-name').value.trim();
      const medicineType = document.getElementById('medicine-type').value;
      const expiryDate = document.getElementById('expiry-date').value;
      
      if (!medicineName || !medicineType || !expiryDate) {
        Swal.fire({
          icon: 'error',
          title: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô',
          text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô'
        });
        return;
      }
      
      const saveBtn = document.getElementById('save-btn');
      saveBtn.disabled = true;
      saveBtn.classList.add('opacity-75');
      
      try {
        Swal.fire({
          title: editingMedicine ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...' : '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...',
          allowOutsideClick: false,
          showConfirmButton: false,
          didOpen: () => Swal.showLoading()
        });
        
        const { daysRemaining, status, exchangeDate } = calculateDaysAndStatus(expiryDate, medicineType);
        
        const medicineData = {
          medicine_name: medicineName,
          type: medicineType,
          expiry_date: expiryDate,
          exchange_date: exchangeDate,
          days_remaining: daysRemaining,
          status: status,
          recorded_at: editingMedicine ? editingMedicine.recorded_at : new Date().toISOString()
        };
        
        const result = await saveMedicine(medicineData);
        
        if (result.success) {
          await loadMedicines();
          hideModal();
          Swal.fire({
            icon: 'success',
            title: editingMedicine ? '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à' : '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
            timer: 1500,
            showConfirmButton: false
          });
        } else {
          Swal.fire({
            icon: 'error',
            title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
            text: result.error || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ'
          });
        }
      } catch (error) {
        console.error('Save error:', error);
        Swal.fire({
          icon: 'error',
          title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
          text: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'
        });
      }
      
      saveBtn.disabled = false;
      saveBtn.classList.remove('opacity-75');
    });

    // Click outside modal to close
    document.getElementById('medicine-modal').addEventListener('click', (e) => {
      if (e.target === e.currentTarget) hideModal();
    });
    
    document.getElementById('detail-modal').addEventListener('click', (e) => {
      if (e.target === e.currentTarget) hideModal();
    });

    document.getElementById('inspector-modal').addEventListener('click', (e) => {
      if (e.target === e.currentTarget) hideModal();
    });

    // Inspection Form Event Listeners
    document.getElementById('clear-signature').addEventListener('click', clearSignature);
    
    document.getElementById('emergencyForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const formData = collectFormData();
      
      // Validation - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö
      const requiredFields = [];
      
      if (!formData.date) requiredFields.push('‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà');
      if (!formData.shift) requiredFields.push('‡πÄ‡∏ß‡∏£');
      if (!formData.box_type) requiredFields.push('‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó Box ‡∏¢‡∏≤');
      if (!formData.inspector) requiredFields.push('‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö');
      if (!formData.signature) requiredFields.push('‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô');
      
      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Radio Button ‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö - ‡∏ï‡∏≤‡∏°‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà
      const requiredRadios = [
        // Floor 1
        'syringe', 'extension_tube', 'iv_set', 'iv_catheter', 'needle', 'three_way',
        'injection_plug', 'sterile_water', 'transpore', 'plaster_tube', 'scissors',
        'tourniquet', 'alcohol', 'saw_blade',
        // Floor 2
        'laryngoscope', 'magill_force', 'guide_wire', 'ky_jelly', 'kidney_bowl', 'nss', 'd5w',
        // Floor 3
        'et_tube_a', 'et_tube_b', 'et_tube_c',
        // Floor 4
        'oral_airway_a', 'oral_airway_b', 'flashlight', 'glasses',
        // Floor 5
        'mask_a', 'mask_b', 'ambu_bag', 'o2_tube'
      ];
      
      requiredRadios.forEach(radioName => {
        const radio = document.querySelector(`input[name="${radioName}"]:checked`);
        if (!radio) {
          requiredFields.push(`‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ ${radioName.replace(/_/g, ' ')}`);
        }
      });
      
      if (requiredFields.length > 0) {
        Swal.fire({
          icon: 'error',
          title: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô',
          html: `‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô:<br><br><strong>${requiredFields.join('<br>')}</strong>`
        });
        return;
      }
      
      const submitBtn = document.getElementById('submit-inspection');
      submitBtn.disabled = true;
      submitBtn.classList.add('opacity-75');
      
      try {
        Swal.fire({
          title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...',
          allowOutsideClick: false,
          showConfirmButton: false,
          didOpen: () => Swal.showLoading()
        });
        
        await submitInspectionForm(formData);
      } finally {
        submitBtn.disabled = false;
        submitBtn.classList.remove('opacity-75');
      }
    });

    // Signature Pad Functions
    function initSignaturePad() {
      const canvas = document.getElementById('signature-pad');
      if (!canvas) return;
      
      signaturePad = {
        canvas: canvas,
        ctx: canvas.getContext('2d'),
        isDrawing: false,
        isEmpty: true
      };
      
      // Set canvas size
      const rect = canvas.getBoundingClientRect();
      canvas.width = rect.width * 2;
      canvas.height = rect.height * 2;
      signaturePad.ctx.scale(2, 2);
      signaturePad.ctx.lineCap = 'round';
      signaturePad.ctx.lineWidth = 2;
      signaturePad.ctx.strokeStyle = '#000';
      
      // Mouse events
      canvas.addEventListener('mousedown', startDrawing);
      canvas.addEventListener('mousemove', draw);
      canvas.addEventListener('mouseup', stopDrawing);
      canvas.addEventListener('mouseout', stopDrawing);
      
      // Touch events
      canvas.addEventListener('touchstart', handleTouch);
      canvas.addEventListener('touchmove', handleTouch);
      canvas.addEventListener('touchend', stopDrawing);
      
      function startDrawing(e) {
        signaturePad.isDrawing = true;
        const rect = canvas.getBoundingClientRect();
        const x = (e.clientX || e.touches[0].clientX) - rect.left;
        const y = (e.clientY || e.touches[0].clientY) - rect.top;
        signaturePad.ctx.beginPath();
        signaturePad.ctx.moveTo(x, y);
        signaturePad.isEmpty = false;
      }
      
      function draw(e) {
        if (!signaturePad.isDrawing) return;
        e.preventDefault();
        const rect = canvas.getBoundingClientRect();
        const x = (e.clientX || e.touches[0].clientX) - rect.left;
        const y = (e.clientY || e.touches[0].clientY) - rect.top;
        signaturePad.ctx.lineTo(x, y);
        signaturePad.ctx.stroke();
      }
      
      function stopDrawing() {
        signaturePad.isDrawing = false;
      }
      
      function handleTouch(e) {
        e.preventDefault();
        const touch = e.touches[0];
        const mouseEvent = new MouseEvent(e.type === 'touchstart' ? 'mousedown' : 
                                        e.type === 'touchmove' ? 'mousemove' : 'mouseup', {
          clientX: touch.clientX,
          clientY: touch.clientY
        });
        canvas.dispatchEvent(mouseEvent);
      }
    }

    function clearSignature() {
      if (signaturePad) {
        signaturePad.ctx.clearRect(0, 0, signaturePad.canvas.width, signaturePad.canvas.height);
        signaturePad.isEmpty = true;
      }
    }

    function getSignatureDataURL() {
      if (signaturePad && !signaturePad.isEmpty) {
        return signaturePad.canvas.toDataURL();
      }
      return null;
    }

    // Form Logic Functions
    function setupFormLogic() {
      const dateInput = document.getElementById('date');
      const shiftSelect = document.getElementById('shift');
      const checkIdInput = document.getElementById('checkId');
      const medicineTypeRadios = document.querySelectorAll('input[name="medicineType"]');
      const medicineChecklist = document.getElementById('medicineChecklist');
      
      // Auto-generate ID when date or shift changes
      function updateCheckId() {
        const date = dateInput.value;
        const shift = shiftSelect.value;
        if (date && shift) {
          checkIdInput.value = `${date}_${shift}`;
        } else {
          checkIdInput.value = '';
        }
      }
      
      dateInput.addEventListener('change', updateCheckId);
      shiftSelect.addEventListener('change', updateCheckId);
      
      // Medicine type selection
      medicineTypeRadios.forEach(radio => {
        radio.addEventListener('change', (e) => {
          if (e.target.value === '‡∏°‡∏µ Box ‡∏¢‡∏≤') {
            medicineChecklist.classList.remove('hidden');
          } else {
            medicineChecklist.classList.add('hidden');
            // Clear all medicine radio buttons
            medicineChecklist.querySelectorAll('input[type="radio"]').forEach(rb => {
              rb.checked = false;
            });
          }
        });
      });
    }

    // Generate unique ID
    function generateInspectionId(date, shift) {
      return `${date}_${shift}`;
    }

    // Check for duplicate inspection
    async function checkDuplicateInspection(inspectionId) {
      try {
        // This would check against existing records in the sheet
        // For now, returning false (no duplicate)
        return false;
      } catch (error) {
        console.error('Check duplicate error:', error);
        return false;
      }
    }

    // Load inspection records
    async function loadInspections() {
      try {
        // Use JSONP for loading data to avoid CORS issues
        return new Promise((resolve) => {
          const callbackName = 'load_inspections_callback_' + Math.round(100000 * Math.random());
          
          window[callbackName] = function(result) {
            delete window[callbackName];
            document.body.removeChild(script);
            
            try {
              if (result && result.success && result.data) {
                allInspections = result.data.map((item, index) => ({
                  id: item.id || (index + 2).toString(),
                  date: item.date || '',
                  shift: item.shift || '',
                  inspector: item.inspector || '',
                  box_type: item.box_type || '',
                  ...item // Include all other fields
                }));
                
                renderInspectionTable(allInspections);
                populateFilterOptions();
                // Apply default filter to show current month/year
                filterInspections();
              } else {
                allInspections = [];
                renderInspectionTable(allInspections);
              }
            } catch (error) {
              console.error('Process inspection data error:', error);
              allInspections = [];
              renderInspectionTable(allInspections);
            }
            resolve();
          };
          
          const script = document.createElement('script');
          script.src = `${INSPECTION_SHEET_URL}?action=load_inspections&callback=${callbackName}&t=${Date.now()}`;
          script.onerror = () => {
            delete window[callbackName];
            document.body.removeChild(script);
            console.error('Script loading failed');
            allInspections = [];
            renderInspectionTable(allInspections);
            resolve();
          };
          
          document.body.appendChild(script);
          
          // Timeout fallback
          setTimeout(() => {
            if (window[callbackName]) {
              delete window[callbackName];
              if (document.body.contains(script)) {
                document.body.removeChild(script);
              }
              console.log('Load inspections timeout');
              allInspections = [];
              renderInspectionTable(allInspections);
              resolve();
            }
          }, 10000);
        });
        
      } catch (error) {
        console.error('Load inspections error:', error);
        allInspections = [];
        renderInspectionTable(allInspections);
      }
    }

   // Render inspection table
    function renderInspectionTable(inspections) {
      const tableBody = document.getElementById('inspection-table-body');
      const emptyState = document.getElementById('inspection-empty-state');
      
      if (!inspections || inspections.length === 0) {
        tableBody.innerHTML = '';
        emptyState.classList.remove('hidden');
        return;
      }
      
      emptyState.classList.add('hidden');
      
      // Sort by date descending (newest first - last row in sheet appears first in table)
      const sortedInspections = [...inspections].sort((a, b) => {
        return new Date(b.date) - new Date(a.date);
      });
      
      tableBody.innerHTML = sortedInspections.map((inspection, index) => `
        <tr class="hover:bg-gray-50 transition-all duration-200 ${index === sortedInspections.length - 1 ? 'rounded-b-2xl' : ''}" data-row-index="${index}">
          <td class="px-6 py-3 text-center ${index === sortedInspections.length - 1 ? 'rounded-bl-2xl' : ''}">
            <div class="text-sm text-gray-800">
              ${inspection.date ? new Date(inspection.date).toLocaleDateString('th-TH', { day: '2-digit', month: '2-digit', year: 'numeric' }) : ''}
            </div>
          </td>
          <td class="px-6 py-3 text-center">
            <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold ${getShiftColor(inspection.shift)}">
              ${inspection.shift || ''}
            </span>
          </td>
          <td class="px-6 py-3 text-center">
  <div class="flex flex-col items-center max-w-[120px] sm:max-w-none">
    <span
      class="text-gray-800 truncate w-full sm:w-auto whitespace-nowrap overflow-hidden"
      title="${inspection.inspector || ''}"
    >
      ${inspection.inspector || ''}
    </span>
    <span class="text-xs text-blue-600 font-semibold bg-blue-100 px-2 py-1 rounded-full mt-1">
      ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà ${getInspectorCount(inspection.inspector, inspection.date, sortedInspections)}
    </span>
  </div>
</td>
          <td class="px-6 py-3 text-center">
            ${inspection.signature ? `
              <img src="${inspection.signature}" alt="‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡∏ä‡∏∑‡πà‡∏≠" class="w-16 h-8 mx-auto border border-gray-200 rounded bg-white object-contain">
            ` : `
              <span class="text-gray-400 text-xs">‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡∏ä‡∏∑‡πà‡∏≠</span>
            `}
          </td>
          <td class="px-6 py-3 text-center ${index === sortedInspections.length - 1 ? 'rounded-br-2xl' : ''}">
            <div class="flex items-center justify-center gap-1">
              <button class="view-inspection-btn bg-blue-100 hover:bg-blue-200 text-blue-600 p-3 rounded-lg transition-all duration-200 hover:scale-105 shadow-sm touch-manipulation" data-row-index="${index}" title="‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                </svg>
              </button>
              <button class="edit-inspection-btn bg-emerald-100 hover:bg-emerald-200 text-emerald-600 p-3 rounded-lg transition-all duration-200 hover:scale-105 shadow-sm touch-manipulation" data-row-index="${index}" title="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                </svg>
              </button>
              <button class="delete-inspection-btn bg-red-100 hover:bg-red-200 text-red-600 p-3 rounded-lg transition-all duration-200 hover:scale-105 shadow-sm touch-manipulation" data-row-index="${index}" title="‡∏•‡∏ö">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                </svg>
              </button>
            </div>
          </td>
        </tr>
      `).join('');
      // Add event listeners
      document.querySelectorAll('.view-inspection-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const rowIndex = parseInt(e.currentTarget.getAttribute('data-row-index'));
          const inspection = sortedInspections[rowIndex];
          if (inspection) showInspectionDetailModal(inspection);
        });
      });
      
      document.querySelectorAll('.edit-inspection-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const rowIndex = parseInt(e.currentTarget.getAttribute('data-row-index'));
          const inspection = sortedInspections[rowIndex];
          if (inspection) editInspection(inspection);
        });
      });
      
      document.querySelectorAll('.delete-inspection-btn').forEach(btn => {
        btn.addEventListener('click', async (e) => {
          const rowIndex = parseInt(e.currentTarget.getAttribute('data-row-index'));
          const inspection = sortedInspections[rowIndex];
          if (inspection) await deleteInspection(inspection);
        });
      });
    }

    // Get shift color
    function getShiftColor(shift) {
      switch (shift) {
        case '‡πÄ‡∏ä‡πâ‡∏≤': return 'bg-yellow-100 text-yellow-700 border-yellow-200';
        case '‡∏ö‡πà‡∏≤‡∏¢': return 'bg-orange-100 text-orange-700 border-orange-200';
        case '‡∏î‡∏∂‡∏Å': return 'bg-purple-100 text-purple-700 border-purple-200';
        default: return 'bg-gray-100 text-gray-700 border-gray-200';
      }
    }

    // Populate filter options
    function populateFilterOptions() {
      const monthFilter = document.getElementById('month-filter');
      const yearFilter = document.getElementById('year-filter');
      
      // Get current date
      const currentDate = new Date();
      const currentMonth = currentDate.getMonth() + 1;
      const currentYear = currentDate.getFullYear();
      
      // Get unique months and years from inspection data
      const months = new Set();
      const years = new Set();
      
      allInspections.forEach(inspection => {
        if (inspection.date) {
          const date = new Date(inspection.date);
          months.add(date.getMonth() + 1);
          years.add(date.getFullYear());
        }
      });
      
      // Add current month/year to sets if not present
      months.add(currentMonth);
      years.add(currentYear);
      
      // Populate month filter
      monthFilter.innerHTML = '<option value="">‡∏ó‡∏∏‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</option>';
      const monthNames = [
        '‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå', '‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°', '‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô', '‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°', '‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô',
        '‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°', '‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô', '‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°', '‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô', '‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°'
      ];
      
      Array.from(months).sort((a, b) => a - b).forEach(month => {
        const option = document.createElement('option');
        option.value = month;
        option.textContent = monthNames[month - 1];
        if (month === currentMonth) {
          option.selected = true; // Set current month as selected
        }
        monthFilter.appendChild(option);
      });
      
      // Populate year filter
      yearFilter.innerHTML = '<option value="">‡∏ó‡∏∏‡∏Å‡∏õ‡∏µ</option>';
      Array.from(years).sort((a, b) => b - a).forEach(year => {
        const option = document.createElement('option');
        option.value = year;
        option.textContent = year + 543; // Convert to Buddhist year
        if (year === currentYear) {
          option.selected = true; // Set current year as selected
        }
        yearFilter.appendChild(option);
      });
    }

    // Filter inspections
    function filterInspections() {
      const monthFilter = document.getElementById('month-filter').value;
      const yearFilter = document.getElementById('year-filter').value;
      
      let filteredInspections = allInspections;
      
      // Apply selected filters
      filteredInspections = allInspections.filter(inspection => {
        if (!inspection.date) return false;
        
        const date = new Date(inspection.date);
        const month = date.getMonth() + 1;
        const year = date.getFullYear();
        
        let matchMonth = !monthFilter || month == monthFilter;
        let matchYear = !yearFilter || year == yearFilter;
        
        return matchMonth && matchYear;
      });
      
      renderInspectionTable(filteredInspections);
    }

    // Show inspection detail modal
    function showInspectionDetailModal(inspection) {
      const modal = document.getElementById('inspection-detail-modal');
      const content = document.getElementById('inspection-detail-content');
      
      content.innerHTML = `
        <div class="space-y-6">
          <!-- Basic Info -->
          <div class="bg-gray-50 p-4 rounded-xl">
            <h4 class="font-bold text-gray-800 mb-3">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô</h4>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
              <div>
                <p class="text-xs text-gray-600 font-semibold">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</p>
                <p class="font-bold">${inspection.date ? new Date(inspection.date).toLocaleDateString('th-TH', { year: 'numeric', month: 'long', day: 'numeric' }) : ''}</p>
              </div>
              <div>
                <p class="text-xs text-gray-600 font-semibold">‡πÄ‡∏ß‡∏£</p>
                <p class="font-bold">${inspection.shift || ''}</p>
              </div>
              <div>
                <p class="text-xs text-gray-600 font-semibold">ID</p>
                <p class="font-bold font-mono">${inspection.id || ''}</p>
              </div>
              <div>
                <p class="text-xs text-gray-600 font-semibold">‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</p>
                <p class="font-bold">${inspection.inspector || ''}</p>
              </div>
            </div>
          </div>

          <!-- Medicine Box Type -->
          <div class="bg-blue-50 p-4 rounded-xl">
            <h4 class="font-bold text-blue-800 mb-3">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó Box ‡∏¢‡∏≤</h4>
            <p class="font-semibold">${inspection.box_type || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</p>
          </div>

          ${inspection.box_type === '‡∏°‡∏µ Box ‡∏¢‡∏≤' ? `
          <!-- Medicine Checklist -->
          <div class="bg-green-50 p-4 rounded-xl">
            <h4 class="font-bold text-green-800 mb-3">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡∏≤</h4>
            <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
              ${['adenosine', 'adrenaline', 'atropine', 'amiodarone', 'dopamine', 'calcium_gluconate', 'nahco3', 'glucose', 'mgso4', 'valium'].map(med => `
                <div class="flex items-center justify-between p-2 bg-white rounded border">
                  <span class="text-sm">${getMedicineName(med)}</span>
                  <span class="${inspection[med] === '‚úì' ? 'text-green-600' : 'text-red-600'} font-bold">
                    ${inspection[med] || '‚úó'}
                  </span>
                </div>
              `).join('')}
            </div>
          </div>
          ` : ''}       
          <!-- Equipment Status -->
          <div class="bg-purple-50 p-4 rounded-xl">
            <h4 class="font-bold text-purple-800 mb-3">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</h4>
            <div class="grid grid-cols-2 md:grid-cols-3 gap-2">
              ${getEquipmentStatusList(inspection).map(item => `
                <div class="flex items-center justify-between p-2 bg-white rounded border text-sm">
                  <span>${item.name}</span>
                  <span class="${item.status === '‚úì' ? 'text-green-600' : 'text-red-600'} font-bold">
                    ${item.status}
                  </span>
                </div>
              `).join('')}
            </div>
          </div>
        </div>
      `;
      
      modal.classList.remove('hidden');
    }

    // Get medicine name in Thai
    function getMedicineName(key) {
      const names = {
        'adenosine': 'Adenosine',
        'adrenaline': 'Adrenaline',
        'atropine': 'Atropine',
        'amiodarone': 'Amiodarone',
        'dopamine': 'Dopamine',
        'calcium_gluconate': '10% Calcium Gluconate',
        'nahco3': '7.5% NaHCO3',
        'glucose': '50% Glucose',
        'mgso4': '50% MgSO4',
        'valium': 'Valium'
      };
      return names[key] || key;
    }

    // Get equipment status list
    function getEquipmentStatusList(inspection) {
      return [
        // Floor 1
        { name: 'Syringe', status: inspection.syringe || '‚úó' },
        { name: 'Extension Tube', status: inspection.extension_tube || '‚úó' },
        { name: 'IV Set', status: inspection.iv_set || '‚úó' },
        { name: 'IV Catheter', status: inspection.iv_catheter || '‚úó' },
        { name: 'Needle', status: inspection.needle || '‚úó' },
        { name: 'Three-way', status: inspection.three_way || '‚úó' },
        { name: 'Injection Plug', status: inspection.injection_plug || '‚úó' },
        { name: 'Sterile Water', status: inspection.sterile_water || '‚úó' },
        { name: 'Transpore', status: inspection.transpore || '‚úó' },
        { name: 'Plaster Tube', status: inspection.plaster_tube || '‚úó' },
        { name: 'Scissors', status: inspection.scissors || '‚úó' },
        { name: 'Tourniquet', status: inspection.tourniquet || '‚úó' },
        { name: 'Alcohol', status: inspection.alcohol || '‚úó' },
        { name: 'Saw Blade', status: inspection.saw_blade || '‚úó' },
        // Floor 2
        { name: 'Laryngoscope', status: inspection.laryngoscope || '‚úó' },
        { name: 'Magill Force', status: inspection.magill_force || '‚úó' },
        { name: 'Guide Wire', status: inspection.guide_wire || '‚úó' },
        { name: 'K-Y Jelly', status: inspection.ky_jelly || '‚úó' },
        { name: 'Kidney Bowl', status: inspection.kidney_bowl || '‚úó' },
        { name: 'NSS', status: inspection.nss || '‚úó' },
        { name: 'D5W', status: inspection.d5w || '‚úó' },
        // Floor 3
        { name: 'ET-Tube A', status: inspection.et_tube_a || '‚úó' },
        { name: 'ET-Tube B', status: inspection.et_tube_b || '‚úó' },
        { name: 'ET-Tube C', status: inspection.et_tube_c || '‚úó' },
        // Floor 4
        { name: 'Oral Airway A', status: inspection.oral_airway_a || '‚úó' },
        { name: 'Oral Airway B', status: inspection.oral_airway_b || '‚úó' },
        { name: 'Flashlight', status: inspection.flashlight || '‚úó' },
        { name: 'Glasses', status: inspection.glasses || '‚úó' },
        // Floor 5
        { name: 'Mask A', status: inspection.mask_a || '‚úó' },
        { name: 'Mask B', status: inspection.mask_b || '‚úó' },
        { name: 'Ambu Bag', status: inspection.ambu_bag || '‚úó' },
        { name: 'O2 Tube', status: inspection.o2_tube || '‚úó' }
      ];
    }

    // Get inspector count for current month
    function getInspectorCount(inspectorName, currentDate, allInspections) {
      if (!inspectorName || !currentDate) return 0;
      
      const current = new Date(currentDate);
      const currentMonth = current.getMonth();
      const currentYear = current.getFullYear();
      
      // Filter inspections for the same inspector in the same month/year
      const sameMonthInspections = allInspections.filter(inspection => {
        if (!inspection.inspector || !inspection.date) return false;
        if (inspection.inspector !== inspectorName) return false;
        
        const inspectionDate = new Date(inspection.date);
        return inspectionDate.getMonth() === currentMonth && 
               inspectionDate.getFullYear() === currentYear &&
               inspectionDate <= current; // Only count up to current date
      });
      
      // Sort by date to get chronological order
      sameMonthInspections.sort((a, b) => new Date(a.date) - new Date(b.date));
      
      // Find the position of current inspection
      const currentIndex = sameMonthInspections.findIndex(inspection => 
        inspection.date === currentDate && inspection.inspector === inspectorName
      );
      
      return currentIndex >= 0 ? currentIndex + 1 : sameMonthInspections.length + 1;
    }

    // Edit inspection
    function editInspection(inspection) {
      editingInspection = inspection;
      
      // Populate form with inspection data
      document.getElementById('date').value = inspection.date || '';
      document.getElementById('shift').value = inspection.shift || '';
      
      // Set medicine type
      const medicineTypeRadio = document.querySelector(`input[name="medicineType"][value="${inspection.box_type}"]`);
      if (medicineTypeRadio) {
        medicineTypeRadio.checked = true;
        
        // Show/hide medicine checklist
        const medicineChecklist = document.getElementById('medicineChecklist');
        if (inspection.box_type === '‡∏°‡∏µ Box ‡∏¢‡∏≤') {
          medicineChecklist.classList.remove('hidden');
          
          // Set medicine values - ‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÉ‡∏´‡∏°‡πà
          ['adenosine', 'adrenaline', 'atropine', 'amiodarone', 'dopamine', 'calcium_gluconate', 'nahco3', 'glucose', 'mgso4', 'valium'].forEach(med => {
            const radio = document.querySelector(`input[name="${med}"][value="${inspection[med]}"]`);
            if (radio) radio.checked = true;
          });
        } else {
          medicineChecklist.classList.add('hidden');
        }
      }
      
      // Set equipment status - ‡∏ï‡∏≤‡∏°‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà
      const equipmentFields = [
        // Floor 1
        'syringe', 'extension_tube', 'iv_set', 'iv_catheter', 'needle', 'three_way',
        'injection_plug', 'sterile_water', 'transpore', 'plaster_tube', 'scissors',
        'tourniquet', 'alcohol', 'saw_blade',
        // Floor 2
        'laryngoscope', 'magill_force', 'guide_wire', 'ky_jelly', 'kidney_bowl', 'nss', 'd5w',
        // Floor 3
        'et_tube_a', 'et_tube_b', 'et_tube_c',
        // Floor 4
        'oral_airway_a', 'oral_airway_b', 'flashlight', 'glasses',
        // Floor 5
        'mask_a', 'mask_b', 'ambu_bag', 'o2_tube'
      ];
      
      equipmentFields.forEach(field => {
        const radio = document.querySelector(`input[name="${field}"][value="${inspection[field]}"]`);
        if (radio) radio.checked = true;
      });
      
      // Set inspector
      document.getElementById('inspector').value = inspection.inspector || '';
      
      // Scroll to form
      document.getElementById('emergencyForm').scrollIntoView({ behavior: 'smooth' });
      
      Swal.fire({
        icon: 'info',
        title: '‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
        text: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏´‡∏°‡πà',
        timer: 2000,
        showConfirmButton: false
      });
    }

    // Delete inspection
    async function deleteInspection(inspection) {
      try {
        const result = await Swal.fire({
          title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö?',
          html: `‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö <strong>${inspection.id}</strong> ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?<br><small class="text-gray-500">‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÑ‡∏î‡πâ</small>`,
          icon: 'warning',
          showCancelButton: true,
          confirmButtonColor: '#ef4444',
          cancelButtonColor: '#6b7280',
          confirmButtonText: '‡∏•‡∏ö',
          cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
        });

        if (result.isConfirmed) {
          Swal.fire({
            title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...',
            allowOutsideClick: false,
            showConfirmButton: false,
            didOpen: () => Swal.showLoading()
          });
          
          // Use FormData to avoid CORS issues
          const formData = new FormData();
          formData.append('action', 'delete_inspection');
          formData.append('id', inspection.id);
          
          const response = await fetch(INSPECTION_SHEET_URL, {
            method: 'POST',
            body: formData
          });
          
          const deleteResult = await response.json();
          
          if (deleteResult.success) {
            await loadInspections();
            Swal.fire({
              icon: 'success',
              title: '‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
              timer: 1500,
              showConfirmButton: false
            });
          } else {
            Swal.fire({
              icon: 'error',
              title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
              text: deleteResult.error || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ'
            });
          }
        }
      } catch (error) {
        console.error('Delete inspection error:', error);
        Swal.fire({
          icon: 'error',
          title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
          text: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ' + error.message
        });
      }
    }

    // Collect form data
    function collectFormData() {
      const formData = {};
      
      // Basic info
      formData.date = document.getElementById('date').value;
      formData.shift = document.getElementById('shift').value;
      formData.id = generateInspectionId(formData.date, formData.shift);
      
      // Get selected medicine type
      const medicineTypeRadio = document.querySelector('input[name="medicineType"]:checked');
      formData.box_type = medicineTypeRadio ? medicineTypeRadio.value : '';
      
      // Helper function to get radio value
      const getRadioValue = (name) => {
        const radio = document.querySelector(`input[name="${name}"]:checked`);
        return radio ? radio.value : '';
      };
      
      // Medicine checklist - ‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÉ‡∏´‡∏°‡πà
      if (formData.box_type === '‡∏°‡∏µ Box ‡∏¢‡∏≤') {
        formData.adenosine = getRadioValue('adenosine');
        formData.adrenaline = getRadioValue('adrenaline');
        formData.atropine = getRadioValue('atropine');
        formData.amiodarone = getRadioValue('amiodarone');
        formData.dopamine = getRadioValue('dopamine');
        formData.calcium_gluconate = getRadioValue('calcium_gluconate');
        formData.nahco3 = getRadioValue('nahco3');
        formData.glucose = getRadioValue('glucose');
        formData.mgso4 = getRadioValue('mgso4');
        formData.valium = getRadioValue('valium');
      }
      
      // Floor 1 equipment - ‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÉ‡∏´‡∏°‡πà
      formData.syringe = getRadioValue('syringe');
      formData.extension_tube = getRadioValue('extension_tube');
      formData.iv_set = getRadioValue('iv_set');
      formData.iv_catheter = getRadioValue('iv_catheter');
      formData.needle = getRadioValue('needle');
      formData.three_way = getRadioValue('three_way');
      formData.injection_plug = getRadioValue('injection_plug');
      formData.sterile_water = getRadioValue('sterile_water');
      formData.transpore = getRadioValue('transpore');
      formData.plaster_tube = getRadioValue('plaster_tube');
      formData.scissors = getRadioValue('scissors');
      formData.tourniquet = getRadioValue('tourniquet');
      formData.alcohol = getRadioValue('alcohol');
      formData.saw_blade = getRadioValue('saw_blade');
      
      // Floor 2 equipment - ‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÉ‡∏´‡∏°‡πà
      formData.laryngoscope = getRadioValue('laryngoscope');
      formData.magill_force = getRadioValue('magill_force');
      formData.guide_wire = getRadioValue('guide_wire');
      formData.ky_jelly = getRadioValue('ky_jelly');
      formData.kidney_bowl = getRadioValue('kidney_bowl');
      formData.nss = getRadioValue('nss');
      formData.d5w = getRadioValue('d5w');
      
      // Floor 3 equipment - ‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÉ‡∏´‡∏°‡πà
      formData.et_tube_a = getRadioValue('et_tube_a');
      formData.et_tube_b = getRadioValue('et_tube_b');
      formData.et_tube_c = getRadioValue('et_tube_c');
      
      // Floor 4 equipment - ‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÉ‡∏´‡∏°‡πà
      formData.oral_airway_a = getRadioValue('oral_airway_a');
      formData.oral_airway_b = getRadioValue('oral_airway_b');
      formData.flashlight = getRadioValue('flashlight');
      formData.glasses = getRadioValue('glasses');
      
      // Floor 5 equipment - ‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÉ‡∏´‡∏°‡πà
      formData.mask_a = getRadioValue('mask_a');
      formData.mask_b = getRadioValue('mask_b');
      formData.ambu_bag = getRadioValue('ambu_bag');
      formData.o2_tube = getRadioValue('o2_tube');
      
      // Inspector info
      formData.inspector = document.getElementById('inspector').value;
      formData.signature = getSignatureDataURL();
      
      return formData;
    }

    // Submit inspection form
    async function submitInspectionForm(formData) {
      try {
        // Check for duplicate
        const isDuplicate = await checkDuplicateInspection(formData.id);
        if (isDuplicate) {
          Swal.fire({
            icon: 'error',
            title: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ã‡πâ‡∏≥',
            text: `‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${formData.date} ‡πÄ‡∏ß‡∏£${formData.shift} ‡πÅ‡∏•‡πâ‡∏ß`
          });
          return;
        }
        
        // Use FormData to avoid CORS issues
        const submitFormData = new FormData();
        submitFormData.append('action', editingInspection ? 'update_inspection' : 'create_inspection');
        submitFormData.append('data', JSON.stringify(formData));
        if (editingInspection) {
          submitFormData.append('id', editingInspection.id);
        }
        
        const response = await fetch(INSPECTION_SHEET_URL, {
          method: 'POST',
          body: submitFormData
        });
        
        const result = await response.json();
        
        if (result.success) {
          await loadInspections(); // Reload inspection table
          
          Swal.fire({
            icon: 'success',
            title: editingInspection ? '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à' : '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
            text: editingInspection ? '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏ñ Emergency ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß' : '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏ñ Emergency ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß',
            timer: 2000,
            showConfirmButton: false
          });
          
          // Reset form and editing state
          document.getElementById('emergencyForm').reset();
          document.getElementById('medicineChecklist').classList.add('hidden');
          clearSignature();
          editingInspection = null;
        } else {
          throw new Error(result.error || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å');
        }
      } catch (error) {
        console.error('Submit inspection error:', error);
        Swal.fire({
          icon: 'error',
          title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
          text: error.message || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ'
        });
      }
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      loadMedicines();
      loadInspections();
      loadInspectorNames();
      initSignaturePad();
      setupFormLogic();
      
      // Set today's date as default
      document.getElementById('date').value = new Date().toISOString().split('T')[0];
      
      // Add filter event listeners
      document.getElementById('month-filter').addEventListener('change', filterInspections);
      document.getElementById('year-filter').addEventListener('change', filterInspections);
      
      // Add modal close event listeners
      document.getElementById('close-inspection-detail-modal').addEventListener('click', () => {
        document.getElementById('inspection-detail-modal').classList.add('hidden');
      });
      
      // Click outside modal to close
      document.getElementById('inspection-detail-modal').addEventListener('click', (e) => {
        if (e.target === e.currentTarget) {
          document.getElementById('inspection-detail-modal').classList.add('hidden');
        }
      });
    });

    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities: (config) => ({
          recolorables: [
            {
              get: () => config.primary_color || defaultConfig.primary_color,
              set: (value) => {
                config.primary_color = value;
                window.elementSdk.setConfig({ primary_color: value });
              }
            }
          ],
          borderables: [],
          fontEditable: {
            get: () => config.font_family || defaultConfig.font_family,
            set: (value) => {
              config.font_family = value;
              window.elementSdk.setConfig({ font_family: value });
            }
          },
          fontSizeable: {
            get: () => config.font_size || defaultConfig.font_size,
            set: (value) => {
              config.font_size = value;
              window.elementSdk.setConfig({ font_size: value });
            }
          }
        }),
        mapToEditPanelValues: (config) => new Map([
          ['app_title', config.app_title || defaultConfig.app_title],
          ['add_button_text', config.add_button_text || defaultConfig.add_button_text]
        ])
      });
    }
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99bd6a78539745b8',t:'MTc2MjY5MjQxNy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
